"use strict";exports.id=0,exports.ids=[0],exports.modules={787:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return i}});let d=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=e(b);if(c&&c.has(a))return c.get(a);var d={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(d,g,h):d[g]=a[g]}return d.default=a,c&&c.set(a,d),d}(c(4515));function e(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(e=function(a){return a?c:b})(a)}let f={current:null},g="function"==typeof d.cache?d.cache:a=>a,h=console.warn;function i(a){return function(...b){h(a(...b))}}g(a=>{try{h(f.current)}finally{f.current=null}})},3535:(a,b,c)=>{let d=c(3033),e=c(9294),f=c(6906),g=c(787),h=c(1938),i=c(9168),j=c(9290);c(3036);new WeakMap;(0,g.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`draftMode()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E377",enumerable:!1,configurable:!0})})},4e3:(a,b,c)=>{let d,e,f,g,h,i,j,k,l;c.d(b,{OF:()=>d3});var m,n,o,p=c(4230);c(4603),c(3535);var q=c(641);class r extends Error{}class s extends r{constructor({code:a,message:b}){super(b??"An error occured while interacting with the authorization server."),this.name="OAuth2Error",this.code=a}}class t extends r{constructor(a){super(a??"Discovery failed for the OpenID Connect configuration."),this.code="discovery_error",this.name="DiscoveryError"}}class u extends r{constructor(a){super(a??"The state parameter is missing."),this.code="missing_state",this.name="MissingStateError"}}class v extends r{constructor(a){super(a??"The state parameter is invalid."),this.code="invalid_state",this.name="InvalidStateError"}}class w extends r{constructor({cause:a,message:b}){super(b??"An error occured during the authorization flow."),this.code="authorization_error",this.cause=a,this.name="AuthorizationError"}}class x extends r{constructor(a){super(a??"An error occured while preparing or performing the authorization code grant request."),this.code="authorization_code_grant_request_error",this.name="AuthorizationCodeGrantRequestError"}}class y extends r{constructor({cause:a,message:b}){super(b??"An error occured while trying to exchange the authorization code."),this.code="authorization_code_grant_error",this.cause=a,this.name="AuthorizationCodeGrantError"}}class z extends r{constructor(a){super(a??"An error occured while completing the backchannel logout request."),this.code="backchannel_logout_error",this.name="BackchannelLogoutError"}}class A extends r{constructor(){super("The authorization server does not support backchannel authentication. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-client-initiated-backchannel-authentication"),this.code="backchannel_authentication_not_supported_error",this.name="BackchannelAuthenticationNotSupportedError"}}class B extends r{constructor({cause:a}){super("There was an error when trying to use Client-Initiated Backchannel Authentication."),this.code="backchannel_authentication_error",this.cause=a,this.name="BackchannelAuthenticationError"}}!function(a){a.MISSING_SESSION="missing_session",a.MISSING_REFRESH_TOKEN="missing_refresh_token",a.FAILED_TO_REFRESH_TOKEN="failed_to_refresh_token"}(m||(m={}));class C extends r{constructor(a,b,c){super(b),this.name="AccessTokenError",this.code=a,this.cause=c}}!function(a){a.MISSING_SESSION="missing_session",a.MISSING_REFRESH_TOKEN="missing_refresh_token",a.FAILED_TO_EXCHANGE="failed_to_exchange_refresh_token"}(n||(n={}));class D extends r{constructor(a,b,c){super(b),this.name="AccessTokenForConnectionError",this.code=a,this.cause=c}}class E extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class F extends E{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class G extends E{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class H extends E{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class I extends E{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class J extends E{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(a="decryption operation failed",b){super(a,b)}}class K extends E{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class L extends E{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class M extends E{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class N extends E{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class O extends E{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(a="no applicable key found in the JSON Web Key Set",b){super(a,b)}}class P extends E{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}class Q extends E{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(a="request timed out",b){super(a,b)}}class R extends E{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(a="signature verification failed",b){super(a,b)}}let S=new TextEncoder,T=new TextDecoder;function U(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}function V(a,b,c){if(b<0||b>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${b}`);a.set([b>>>24,b>>>16,b>>>8,255&b],c)}function W(a){let b=Math.floor(a/0x100000000),c=new Uint8Array(8);return V(c,b,0),V(c,a%0x100000000,4),c}function X(a){let b=new Uint8Array(4);return V(b,a),b}function Y(a){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(a);let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);return c}function Z(a){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof a?a:T.decode(a),{alphabet:"base64url"});let b=a;b instanceof Uint8Array&&(b=T.decode(b)),b=b.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Y(b)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function $(a){let b=a;return("string"==typeof b&&(b=S.encode(b)),Uint8Array.prototype.toBase64)?b.toBase64({alphabet:"base64url",omitPadding:!0}):(function(a){if(Uint8Array.prototype.toBase64)return a.toBase64();let b=[];for(let c=0;c<a.length;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return btoa(b.join(""))})(b).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}let _=(a,b)=>{if(a.byteLength!==b.length)return!1;for(let c=0;c<a.byteLength;c++)if(a[c]!==b[c])return!1;return!0},aa=a=>{let b=a.data[a.pos++];if(128&b){let c=127&b,d=0;for(let b=0;b<c;b++)d=d<<8|a.data[a.pos++];return d}return b},ab=(a,b,c)=>{if(a.data[a.pos++]!==b)throw Error(c)},ac=(a,b)=>{let c=a.data.subarray(a.pos,a.pos+b);return a.pos+=b,c},ad=async(a,b,c,d)=>{let e,f,g="spki"===a,h=()=>g?["verify"]:["sign"];switch(c){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${c.slice(-3)}`},f=h();break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${c.slice(-3)}`},f=h();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(c.slice(-3),10)||1}`},f=g?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":e={name:"ECDSA",namedCurve:({ES256:"P-256",ES384:"P-384",ES512:"P-521"})[c]},f=h();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{let a=d.getNamedCurve(b);e="X25519"===a?{name:"X25519"}:{name:"ECDH",namedCurve:a}}catch(a){throw new I("Invalid or unsupported key format")}f=g?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":e={name:"Ed25519"},f=h();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":e={name:c},f=h();break;default:throw new I('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(a,b,e,d?.extractable??!!g,f)},ae=async a=>{if(!a.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:b,keyUsages:c}=function(a){let b,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":b={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":b={name:"RSA-PSS",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":b={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":b={name:"RSA-OAEP",hash:`SHA-${parseInt(a.alg.slice(-3),10)||1}`},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":b={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":b={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":b={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":b={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new I('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:b,keyUsages:c}}(a),d={...a};return"AKP"!==d.kty&&delete d.alg,delete d.use,crypto.subtle.importKey("jwk",d,b,a.ext??(!a.d&&!a.priv),a.key_ops??c)},af=a=>{if(!function(a){return"object"==typeof a&&null!==a}(a)||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b};async function ag(a,b,c){let d;if("string"!=typeof a||0!==a.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');let e=(d=/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,Y(a.replace(d,""))),f=c;return b?.startsWith?.("ECDH-ES")&&((f||={}).getNamedCurve=a=>{let b={data:a,pos:0};return!function(a){ab(a,48,"Invalid PKCS#8 structure"),aa(a),ab(a,2,"Expected version field");let b=aa(a);a.pos+=b,ab(a,48,"Expected algorithm identifier"),aa(a),a.pos}(b),(a=>{let b=(a=>{ab(a,6,"Expected algorithm OID");let b=aa(a);return ac(a,b)})(a);if(_(b,[43,101,110]))return"X25519";if(!_(b,[42,134,72,206,61,2,1]))throw Error("Unsupported key algorithm");ab(a,6,"Expected curve OID");let c=aa(a),d=ac(a,c);for(let{name:a,oid:b}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(_(d,b))return a;throw Error("Unsupported named curve")})(b)}),ad("pkcs8",e,b,f)}async function ah(a,b,c){let d;if(!af(a))throw TypeError("JWK must be an object");switch(b??=a.alg,d??=c?.extractable??a.ext,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return Z(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new I('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return ae({...a,alg:b,ext:d});case"AKP":if("string"!=typeof a.alg||!a.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==b&&b!==a.alg)throw TypeError("JWK alg and alg option value mismatch");return ae({...a,ext:d});case"EC":case"OKP":return ae({...a,alg:b,ext:d});default:throw new I('Unsupported "kty" (Key Type) Parameter value')}}function ai(a){return af(a)}class aj{#a;#b=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(ai)}(a))throw new N("JSON Web Key Set malformed");this.#a=structuredClone(a)}jwks(){return this.#a}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new I('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this.#a.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&("string"==typeof a.alg||"AKP"===e)&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":case"EdDSA":b="Ed25519"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new O;if(1!==h){let a=new P,b=this.#b;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await ak(b,a,c)}catch{}},a}return ak(this.#b,g,c)}}async function ak(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await ah({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new N("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function al(a){let b=new aj(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>structuredClone(b.jwks()),enumerable:!1,configurable:!1,writable:!1}}),c}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(d="jose/v6.1.0");let am=Symbol();async function an(a,b,c,d=fetch){let e=await d(a,{method:"GET",signal:c,redirect:"manual",headers:b}).catch(a=>{if("TimeoutError"===a.name)throw new Q;throw a});if(200!==e.status)throw new E("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await e.json()}catch{throw new E("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let ao=Symbol();class ap{#c;#d;#e;#f;#g;#h;#i;#j;#k;#l;constructor(a,b){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this.#c=new URL(a.href),this.#d="number"==typeof b?.timeoutDuration?b?.timeoutDuration:5e3,this.#e="number"==typeof b?.cooldownDuration?b?.cooldownDuration:3e4,this.#f="number"==typeof b?.cacheMaxAge?b?.cacheMaxAge:6e5,this.#i=new Headers(b?.headers),d&&!this.#i.has("User-Agent")&&this.#i.set("User-Agent",d),this.#i.has("accept")||(this.#i.set("accept","application/json"),this.#i.append("accept","application/jwk-set+json")),this.#j=b?.[am],b?.[ao]!==void 0&&(this.#l=b?.[ao],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!af(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,af)}(b?.[ao],this.#f)&&(this.#g=this.#l.uat,this.#k=al(this.#l.jwks)))}pendingFetch(){return!!this.#h}coolingDown(){return"number"==typeof this.#g&&Date.now()<this.#g+this.#e}fresh(){return"number"==typeof this.#g&&Date.now()<this.#g+this.#f}jwks(){return this.#k?.jwks()}async getKey(a,b){this.#k&&this.fresh()||await this.reload();try{return await this.#k(a,b)}catch(c){if(c instanceof O&&!1===this.coolingDown())return await this.reload(),this.#k(a,b);throw c}}async reload(){this.#h&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#h=void 0),this.#h||=an(this.#c.href,this.#i,AbortSignal.timeout(this.#d),this.#j).then(a=>{this.#k=al(a),this.#l&&(this.#l.uat=Date.now(),this.#l.jwks=a),this.#g=Date.now(),this.#h=void 0}).catch(a=>{throw this.#h=void 0,a}),await this.#h}}let aq=(a,b)=>{if(a.startsWith("RS")||a.startsWith("PS")){let{modulusLength:c}=b.algorithm;if("number"!=typeof c||c<2048)throw TypeError(`${a} requires key modulusLength to be 2048 bits or larger`)}};function ar(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function as(a,b){return a.name===b}function at(a){return parseInt(a.name.slice(4),10)}function au(a,b){if(b&&!a.usages.includes(b))throw TypeError(`CryptoKey does not support this operation, its usages must include ${b}.`)}function av(a,b,c){switch(b){case"A128GCM":case"A192GCM":case"A256GCM":{if(!as(a.algorithm,"AES-GCM"))throw ar("AES-GCM");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw ar(c,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!as(a.algorithm,"AES-KW"))throw ar("AES-KW");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw ar(c,"algorithm.length");break}case"ECDH":switch(a.algorithm.name){case"ECDH":case"X25519":break;default:throw ar("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!as(a.algorithm,"PBKDF2"))throw ar("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!as(a.algorithm,"RSA-OAEP"))throw ar("RSA-OAEP");let c=parseInt(b.slice(9),10)||1;if(at(a.algorithm.hash)!==c)throw ar(`SHA-${c}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}au(a,c)}function aw(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}let ax=(a,...b)=>aw("Key must be ",a,...b);function ay(a,b,...c){return aw(`Key for the ${a} algorithm must be `,b,...c)}let az=async(a,b,c)=>{if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(ax(b,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",b,{hash:`SHA-${a.slice(-3)}`,name:"HMAC"},!1,[c])}return!function(a,b,c){switch(b){case"HS256":case"HS384":case"HS512":{if(!as(a.algorithm,"HMAC"))throw ar("HMAC");let c=parseInt(b.slice(2),10);if(at(a.algorithm.hash)!==c)throw ar(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!as(a.algorithm,"RSASSA-PKCS1-v1_5"))throw ar("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(at(a.algorithm.hash)!==c)throw ar(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!as(a.algorithm,"RSA-PSS"))throw ar("RSA-PSS");let c=parseInt(b.slice(2),10);if(at(a.algorithm.hash)!==c)throw ar(`SHA-${c}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!as(a.algorithm,"Ed25519"))throw ar("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!as(a.algorithm,b))throw ar(b);break;case"ES256":case"ES384":case"ES512":{if(!as(a.algorithm,"ECDSA"))throw ar("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw ar(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}au(a,c)}(b,a,c),b},aA=async(a,b,c,d)=>{let e=await az(a,b,"verify");aq(a,e);let f=((a,b)=>{let c=`SHA-${a.slice(-3)}`;switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:b.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new I(`alg ${a} is not supported either by JOSE or your javascript runtime`)}})(a,e.algorithm);try{return await crypto.subtle.verify(f,e,c,d)}catch{return!1}},aB=(...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0};function aC(a){if(!aD(a))throw Error("CryptoKey instance expected")}function aD(a){return a?.[Symbol.toStringTag]==="CryptoKey"}function aE(a){return a?.[Symbol.toStringTag]==="KeyObject"}let aF=a=>aD(a)||aE(a);function aG(a){return af(a)&&"string"==typeof a.kty}let aH=a=>a?.[Symbol.toStringTag],aI=(a,b,c)=>{if(void 0!==b.use){let a;switch(c){case"sign":case"verify":a="sig";break;case"encrypt":case"decrypt":a="enc"}if(b.use!==a)throw TypeError(`Invalid key for this operation, its "use" must be "${a}" when present`)}if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, its "alg" must be "${a}" when present`);if(Array.isArray(b.key_ops)){let d;switch(!0){case"sign"===c||"verify"===c:case"dir"===a:case a.includes("CBC-HS"):d=c;break;case a.startsWith("PBES2"):d="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(a):d=!a.includes("GCM")&&a.endsWith("KW")?"encrypt"===c?"wrapKey":"unwrapKey":c;break;case"encrypt"===c&&a.startsWith("RSA"):d="wrapKey";break;case"decrypt"===c:d=a.startsWith("RSA")?"unwrapKey":"deriveBits"}if(d&&b.key_ops?.includes?.(d)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${d}" when present`)}return!0},aJ=(a,b,c)=>{a.startsWith("HS")||"dir"===a||a.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(a)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(a)?((a,b,c)=>{if(!(b instanceof Uint8Array)){if(aG(b)){if(function(a){return"oct"===a.kty&&"string"==typeof a.k}(b)&&aI(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!aF(b))throw TypeError(ay(a,b,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==b.type)throw TypeError(`${aH(b)} instances for symmetric algorithms must be of type "secret"`)}})(a,b,c):((a,b,c)=>{if(aG(b))switch(c){case"decrypt":case"sign":if(function(a){return"oct"!==a.kty&&("AKP"===a.kty&&"string"==typeof a.priv||"string"==typeof a.d)}(b)&&aI(a,b,c))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(function(a){return"oct"!==a.kty&&void 0===a.d&&void 0===a.priv}(b)&&aI(a,b,c))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!aF(b))throw TypeError(ay(a,b,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===b.type)throw TypeError(`${aH(b)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===b.type)switch(c){case"sign":throw TypeError(`${aH(b)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${aH(b)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===b.type)switch(c){case"verify":throw TypeError(`${aH(b)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${aH(b)} instances for asymmetric algorithm encryption must be of type "public"`)}})(a,b,c)},aK=(a,b,c,d,e)=>{let f;if(void 0!==e.crit&&d?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new I(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)},aL=(a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)},aM=async(a,b,c,d=!1)=>{let f=(e||=new WeakMap).get(a);if(f?.[c])return f[c];let g=await ae({...b,alg:c});return d&&Object.freeze(a),f?f[c]=g:e.set(a,{[c]:g}),g},aN=async(a,b)=>{if(a instanceof Uint8Array||aD(a))return a;if(aE(a)){if("secret"===a.type)return a.export();if("toCryptoKey"in a&&"function"==typeof a.toCryptoKey)try{return((a,b)=>{let c,d=(e||=new WeakMap).get(a);if(d?.[b])return d[b];let f="public"===a.type,g=!!f;if("x25519"===a.asymmetricKeyType){switch(b){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}c=a.toCryptoKey(a.asymmetricKeyType,g,f?[]:["deriveBits"])}if("ed25519"===a.asymmetricKeyType){if("EdDSA"!==b&&"Ed25519"!==b)throw TypeError("given KeyObject instance cannot be used for this algorithm");c=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}switch(a.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(b!==a.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");c=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}if("rsa"===a.asymmetricKeyType){let d;switch(b){case"RSA-OAEP":d="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":d="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":d="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":d="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(b.startsWith("RSA-OAEP"))return a.toCryptoKey({name:"RSA-OAEP",hash:d},g,f?["encrypt"]:["decrypt"]);c=a.toCryptoKey({name:b.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:d},g,[f?"verify":"sign"])}if("ec"===a.asymmetricKeyType){let d=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(a.asymmetricKeyDetails?.namedCurve);if(!d)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===b&&"P-256"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),"ES384"===b&&"P-384"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),"ES512"===b&&"P-521"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),b.startsWith("ECDH-ES")&&(c=a.toCryptoKey({name:"ECDH",namedCurve:d},g,f?[]:["deriveBits"]))}if(!c)throw TypeError("given KeyObject instance cannot be used for this algorithm");return d?d[b]=c:e.set(a,{[b]:c}),c})(a,b)}catch(a){if(a instanceof TypeError)throw a}let c=a.export({format:"jwk"});return aM(a,c,b)}if(aG(a))return a.k?Z(a.k):aM(a,a,b,!0);throw Error("unreachable")};async function aO(a,b,c){let d,e;if(!af(a))throw new L("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new L('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new L("JWS Protected Header incorrect type");if(void 0===a.payload)throw new L("JWS Payload missing");if("string"!=typeof a.signature)throw new L("JWS Signature missing or incorrect type");if(void 0!==a.header&&!af(a.header))throw new L("JWS Unprotected Header incorrect type");let f={};if(a.protected)try{let b=Z(a.protected);f=JSON.parse(T.decode(b))}catch{throw new L("JWS Protected Header is invalid")}if(!aB(f,a.header))throw new L("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...f,...a.header},h=aK(L,new Map([["b64",!0]]),c?.crit,f,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=f.b64))throw new L('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new L('JWS "alg" (Algorithm) Header Parameter missing or invalid');let k=c&&aL("algorithms",c.algorithms);if(k&&!k.has(j))throw new H('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof a.payload)throw new L("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new L("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof b&&(b=await b(f,a),l=!0),aJ(j,b,"verify");let m=U(S.encode(a.protected??""),S.encode("."),"string"==typeof a.payload?S.encode(a.payload):a.payload);try{d=Z(a.signature)}catch{throw new L("Failed to base64url decode the signature")}let n=await aN(b,j);if(!await aA(j,n,d,m))throw new R;if(i)try{e=Z(a.payload)}catch{throw new L("Failed to base64url decode the payload")}else e="string"==typeof a.payload?S.encode(a.payload):a.payload;let o={payload:e};return(void 0!==a.protected&&(o.protectedHeader=f),void 0!==a.header&&(o.unprotectedHeader=a.header),l)?{...o,key:n}:o}async function aP(a,b,c){if(a instanceof Uint8Array&&(a=T.decode(a)),"string"!=typeof a)throw new L("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new L("Invalid Compact JWS");let h=await aO({payload:e,protected:d,signature:f},b,c),i={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...i,key:h.key}:i}let aQ=a=>Math.floor(a.getTime()/1e3),aR=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,aS=a=>{let b,c=aR.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b};function aT(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}let aU=a=>a.includes("/")?a.toLowerCase():`application/${a.toLowerCase()}`;function aV(a,b,c={}){var d,e;let f,g;try{f=JSON.parse(T.decode(b))}catch{}if(!af(f))throw new M("JWT Claims Set must be a top-level JSON object");let{typ:h}=c;if(h&&("string"!=typeof a.typ||aU(a.typ)!==aU(h)))throw new F('unexpected "typ" JWT header value',f,"typ","check_failed");let{requiredClaims:i=[],issuer:j,subject:k,audience:l,maxTokenAge:m}=c,n=[...i];for(let a of(void 0!==m&&n.push("iat"),void 0!==l&&n.push("aud"),void 0!==k&&n.push("sub"),void 0!==j&&n.push("iss"),new Set(n.reverse())))if(!(a in f))throw new F(`missing required "${a}" claim`,f,a,"missing");if(j&&!(Array.isArray(j)?j:[j]).includes(f.iss))throw new F('unexpected "iss" claim value',f,"iss","check_failed");if(k&&f.sub!==k)throw new F('unexpected "sub" claim value',f,"sub","check_failed");if(l&&(d=f.aud,e="string"==typeof l?[l]:l,"string"==typeof d?!e.includes(d):!(Array.isArray(d)&&e.some(Set.prototype.has.bind(new Set(d))))))throw new F('unexpected "aud" claim value',f,"aud","check_failed");switch(typeof c.clockTolerance){case"string":g=aS(c.clockTolerance);break;case"number":g=c.clockTolerance;break;case"undefined":g=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:o}=c,p=aQ(o||new Date);if((void 0!==f.iat||m)&&"number"!=typeof f.iat)throw new F('"iat" claim must be a number',f,"iat","invalid");if(void 0!==f.nbf){if("number"!=typeof f.nbf)throw new F('"nbf" claim must be a number',f,"nbf","invalid");if(f.nbf>p+g)throw new F('"nbf" claim timestamp check failed',f,"nbf","check_failed")}if(void 0!==f.exp){if("number"!=typeof f.exp)throw new F('"exp" claim must be a number',f,"exp","invalid");if(f.exp<=p-g)throw new G('"exp" claim timestamp check failed',f,"exp","check_failed")}if(m){let a=p-f.iat;if(a-g>("number"==typeof m?m:aS(m)))throw new G('"iat" claim timestamp check failed (too far in the past)',f,"iat","check_failed");if(a<0-g)throw new F('"iat" claim timestamp check failed (it should be in the past)',f,"iat","check_failed")}return f}class aW{#m;constructor(a){if(!af(a))throw TypeError("JWT Claims Set MUST be an object");this.#m=structuredClone(a)}data(){return S.encode(JSON.stringify(this.#m))}get iss(){return this.#m.iss}set iss(a){this.#m.iss=a}get sub(){return this.#m.sub}set sub(a){this.#m.sub=a}get aud(){return this.#m.aud}set aud(a){this.#m.aud=a}set jti(a){this.#m.jti=a}set nbf(a){"number"==typeof a?this.#m.nbf=aT("setNotBefore",a):a instanceof Date?this.#m.nbf=aT("setNotBefore",aQ(a)):this.#m.nbf=aQ(new Date)+aS(a)}set exp(a){"number"==typeof a?this.#m.exp=aT("setExpirationTime",a):a instanceof Date?this.#m.exp=aT("setExpirationTime",aQ(a)):this.#m.exp=aQ(new Date)+aS(a)}set iat(a){void 0===a?this.#m.iat=aQ(new Date):a instanceof Date?this.#m.iat=aT("setIssuedAt",aQ(a)):"string"==typeof a?this.#m.iat=aT("setIssuedAt",aQ(new Date)+aS(a)):this.#m.iat=aT("setIssuedAt",a)}}async function aX(a,b,c){let d=await aP(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new M("JWTs MUST NOT use unencoded payload");let e={payload:aV(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}function aY(a,b){if(null==a)return!1;try{return a instanceof b||Object.getPrototypeOf(a)[Symbol.toStringTag]===b.prototype[Symbol.toStringTag]}catch{return!1}}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(f="oauth4webapi/v3.8.1");let aZ="ERR_INVALID_ARG_VALUE",a$="ERR_INVALID_ARG_TYPE";function a_(a,b,c){let d=TypeError(a,{cause:c});return Object.assign(d,{code:b}),d}let a0=Symbol(),a1=Symbol(),a2=Symbol(),a3=Symbol(),a4=(Symbol(),Symbol());Symbol();let a5=new TextEncoder,a6=new TextDecoder;function a7(a){return"string"==typeof a?a5.encode(a):a6.decode(a)}function a8(a){return"string"==typeof a?h(a):g(a)}g=Uint8Array.prototype.toBase64?a=>(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),a.toBase64({alphabet:"base64url",omitPadding:!0})):a=>{a instanceof ArrayBuffer&&(a=new Uint8Array(a));let b=[];for(let c=0;c<a.byteLength;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return btoa(b.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},h=Uint8Array.fromBase64?a=>{try{return Uint8Array.fromBase64(a,{alphabet:"base64url"})}catch(a){throw a_("The input to be decoded is not correctly encoded.",aZ,a)}}:a=>{try{let b=atob(a.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);return c}catch(a){throw a_("The input to be decoded is not correctly encoded.",aZ,a)}};class a9 extends Error{code;constructor(a,b){super(a,b),this.name=this.constructor.name,this.code=b6,Error.captureStackTrace?.(this,this.constructor)}}class ba extends Error{code;constructor(a,b){super(a,b),this.name=this.constructor.name,b?.code&&(this.code=b?.code),Error.captureStackTrace?.(this,this.constructor)}}function bb(a,b,c){return new ba(a,{code:b,cause:c})}function bc(a){return!(null===a||"object"!=typeof a||Array.isArray(a))}function bd(a){aY(a,Headers)&&(a=Object.fromEntries(a.entries()));let b=new Headers(a??{});if(f&&!b.has("user-agent")&&b.set("user-agent",f),b.has("authorization"))throw a_('"options.headers" must not include the "authorization" header name',aZ);return b}function be(a,b){if(void 0!==b){if("function"==typeof b&&(b=b(a.href)),!(b instanceof AbortSignal))throw a_('"options.signal" must return or be an instance of AbortSignal',a$);return b}}function bf(a){return a.includes("//")?a.replace("//","/"):a}async function bg(a,b,c,d){if(!(a instanceof URL))throw a_(`"${b}" must be an instance of URL`,a$);bw(a,d?.[a0]!==!0);let e=c(new URL(a.href)),f=bd(d?.headers);return f.set("accept","application/json"),(d?.[a3]||fetch)(e.href,{body:void 0,headers:Object.fromEntries(f.entries()),method:"GET",redirect:"manual",signal:be(e,d?.signal)})}async function bh(a,b){return bg(a,"issuerIdentifier",a=>{switch(b?.algorithm){case void 0:case"oidc":a.pathname=bf(`${a.pathname}/.well-known/openid-configuration`);break;case"oauth2":!function(a,b,c=!1){"/"===a.pathname?a.pathname=b:a.pathname=bf(`${b}/${c?a.pathname:a.pathname.replace(/(\/)$/,"")}`)}(a,".well-known/oauth-authorization-server");break;default:throw a_('"options.algorithm" must be "oidc" (default), or "oauth2"',aZ)}return a},b)}function bi(a,b,c,d,e){try{if("number"!=typeof a||!Number.isFinite(a))throw a_(`${c} must be a number`,a$,e);if(a>0)return;if(b){if(0!==a)throw a_(`${c} must be a non-negative number`,aZ,e);return}throw a_(`${c} must be a positive number`,aZ,e)}catch(a){if(d)throw bb(a.message,d,e);throw a}}function bj(a,b,c,d){try{if("string"!=typeof a)throw a_(`${b} must be a string`,a$,d);if(0===a.length)throw a_(`${b} must not be empty`,aZ,d)}catch(a){if(c)throw bb(a.message,c,d);throw a}}async function bk(a,b){if(!(a instanceof URL)&&a!==cx)throw a_('"expectedIssuerIdentifier" must be an instance of URL',a$);if(!aY(b,Response))throw a_('"response" must be an instance of Response',a$);if(200!==b.status)throw bb('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',cb,b);cl(b);let c=await cw(b);if(bj(c.issuer,'"response" body "issuer" property',b9,{body:c}),a!==cx&&new URL(c.issuer).href!==a.href)throw bb('"response" body "issuer" property does not match the expected value',cg,{expected:a.href,body:c,attribute:"issuer"});return c}function bl(a){var b,c=a,d="application/json";if(b=c,b.headers.get("content-type")?.split(";")[0]!==d)throw function(a,...b){let c='"response" content-type must be ';if(b.length>2){let a=b.pop();c+=`${b.join(", ")}, or ${a}`}else 2===b.length?c+=`${b[0]} or ${b[1]}`:c+=b[0];return bb(c,ca,a)}(c,d)}function bm(){return a8(crypto.getRandomValues(new Uint8Array(32)))}async function bn(a){return bj(a,"codeVerifier"),a8(await crypto.subtle.digest("SHA-256",a7(a)))}function bo(a){let b=a?.[a1];return"number"==typeof b&&Number.isFinite(b)?b:0}function bp(a){let b=a?.[a2];return"number"==typeof b&&Number.isFinite(b)&&-1!==Math.sign(b)?b:30}function bq(){return Math.floor(Date.now()/1e3)}function br(a){if("object"!=typeof a||null===a)throw a_('"as" must be an object',a$);bj(a.issuer,'"as.issuer"')}function bs(a){if("object"!=typeof a||null===a)throw a_('"client" must be an object',a$);bj(a.client_id,'"client.client_id"')}function bt(a){return bj(a,'"clientSecret"'),(b,c,d,e)=>{d.set("client_id",c.client_id),d.set("client_secret",a)}}async function bu(a,b,c){if(!c.usages.includes("sign"))throw a_('CryptoKey instances used for signing assertions must include "sign" in their "usages"',aZ);let d=`${a8(a7(JSON.stringify(a)))}.${a8(a7(JSON.stringify(b)))}`,e=a8(await crypto.subtle.sign(function(a){switch(a.algorithm.name){case"ECDSA":return{name:a.algorithm.name,hash:function(a){let{algorithm:b}=a;switch(b.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new a9("unsupported ECDSA namedCurve",{cause:a})}}(a)};case"RSA-PSS":switch(cm(a),a.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:a.algorithm.name,saltLength:parseInt(a.algorithm.hash.name.slice(-3),10)>>3};default:throw new a9("unsupported RSA-PSS hash name",{cause:a})}case"RSASSA-PKCS1-v1_5":return cm(a),a.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return a.algorithm.name}throw new a9("unsupported CryptoKey algorithm name",{cause:a})}(c),c,a7(d)));return`${d}.${e}`}let bv=URL.parse?(a,b)=>URL.parse(a,b):(a,b)=>{try{return new URL(a,b)}catch{return null}};function bw(a,b){if(b&&"https:"!==a.protocol)throw bb("only requests to HTTPS are allowed",cc,a);if("https:"!==a.protocol&&"http:"!==a.protocol)throw bb("only HTTP and HTTPS requests are allowed",cd,a)}function bx(a,b,c,d){let e;if("string"!=typeof a||!(e=bv(a)))throw bb(`authorization server metadata does not contain a valid ${c?`"as.mtls_endpoint_aliases.${b}"`:`"as.${b}"`}`,void 0===a?ch:ci,{attribute:c?`mtls_endpoint_aliases.${b}`:b});return bw(e,d),e}function by(a,b,c,d){return c&&a.mtls_endpoint_aliases&&b in a.mtls_endpoint_aliases?bx(a.mtls_endpoint_aliases[b],b,c,d):bx(a[b],b,c,d)}async function bz(a,b,c,d,e){br(a),bs(b);let f=by(a,"pushed_authorization_request_endpoint",b.use_mtls_endpoint_aliases,e?.[a0]!==!0),g=new URLSearchParams(d);g.set("client_id",b.client_id);let h=bd(e?.headers);h.set("accept","application/json"),e?.DPoP!==void 0&&(bL(e.DPoP),await e.DPoP.addProof(f,h,"POST"));let i=await bM(a,b,c,f,g,h,e);return e?.DPoP?.cacheNonce(i),i}class bA extends Error{cause;code;error;status;error_description;response;constructor(a,b){super(a,b),this.name=this.constructor.name,this.code=b5,this.cause=b.cause,this.error=b.cause.error,this.status=b.response.status,this.error_description=b.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:b.response}),Error.captureStackTrace?.(this,this.constructor)}}class bB extends Error{cause;code;error;error_description;constructor(a,b){super(a,b),this.name=this.constructor.name,this.code=b7,this.cause=b.cause,this.error=b.cause.get("error"),this.error_description=b.cause.get("error_description")??void 0,Error.captureStackTrace?.(this,this.constructor)}}class bC extends Error{cause;code;response;status;constructor(a,b){super(a,b),this.name=this.constructor.name,this.code=b4,this.cause=b.cause,this.status=b.response.status,this.response=b.response,Object.defineProperty(this,"response",{enumerable:!1}),Error.captureStackTrace?.(this,this.constructor)}}let bD="[a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+",bE=RegExp("^[,\\s]*("+bD+")\\s(.*)"),bF=RegExp("^[,\\s]*("+bD+')\\s*=\\s*"((?:[^"\\\\]|\\\\.)*)"[,\\s]*(.*)'),bG=RegExp("^[,\\s]*"+("("+bD+")\\s*=\\s*(")+bD+")[,\\s]*(.*)"),bH=RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+[=]{0,2})(?:$|[,\\s])(.*)");async function bI(a,b,c){if(br(a),bs(b),!aY(c,Response))throw a_('"response" must be an instance of Response',a$);await bK(c,201,"Pushed Authorization Request Endpoint"),cl(c);let d=await cw(c);bj(d.request_uri,'"response" body "request_uri" property',b9,{body:d});let e="number"!=typeof d.expires_in?parseFloat(d.expires_in):d.expires_in;return bi(e,!0,'"response" body "expires_in" property',b9,{body:d}),d.expires_in=e,d}async function bJ(a){if(a.status>399&&a.status<500){cl(a),bl(a);try{let b=await a.clone().json();if(bc(b)&&"string"==typeof b.error&&b.error.length)return b}catch{}}}async function bK(a,b,c){if(a.status!==b){let b;if(function(a){let b;if(b=function(a){if(!aY(a,Response))throw a_('"response" must be an instance of Response',a$);let b=a.headers.get("www-authenticate");if(null===b)return;let c=[],d=b;for(;d;){let a,b=d.match(bE),e=b?.["1"].toLowerCase();if(d=b?.["2"],!e)return;let f={};for(;d;){let c,e;if(b=d.match(bF)){if([,c,e,d]=b,e.includes("\\"))try{e=JSON.parse(`"${e}"`)}catch{}f[c.toLowerCase()]=e;continue}if(b=d.match(bG)){[,c,e,d]=b,f[c.toLowerCase()]=e;continue}if(b=d.match(bH)){if(Object.keys(f).length)break;[,a,d]=b;break}return}let g={scheme:e,parameters:f};a&&(g.token68=a),c.push(g)}if(c.length)return c}(a))throw new bC("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:b,response:a})}(a),b=await bJ(a))throw await a.body?.cancel(),new bA("server responded with an error in the response body",{cause:b,response:a});throw bb(`"response" is not a conform ${c} response (unexpected HTTP status code)`,cb,a)}}function bL(a){if(!bW.has(a))throw a_('"options.DPoP" is not a valid DPoPHandle',aZ)}async function bM(a,b,c,d,e,f,g){return await c(a,b,e,f),f.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(g?.[a3]||fetch)(d.href,{body:e,headers:Object.fromEntries(f.entries()),method:"POST",redirect:"manual",signal:be(d,g?.signal)})}async function bN(a,b,c,d,e,f){let g=by(a,"token_endpoint",b.use_mtls_endpoint_aliases,f?.[a0]!==!0);e.set("grant_type",d);let h=bd(f?.headers);h.set("accept","application/json"),f?.DPoP!==void 0&&(bL(f.DPoP),await f.DPoP.addProof(g,h,"POST"));let i=await bM(a,b,c,g,e,h,f);return f?.DPoP?.cacheNonce(i),i}async function bO(a,b,c,d,e){br(a),bs(b),bj(d,'"refreshToken"');let f=new URLSearchParams(e?.additionalParameters);return f.set("refresh_token",d),bN(a,b,c,"refresh_token",f,e)}Symbol();let bP=new WeakMap,bQ=new WeakMap;function bR(a){if(!a.id_token)return;let b=bP.get(a);if(!b)throw a_('"ref" was already garbage collected or did not resolve from the proper sources',aZ);return b}async function bS(a,b,c,d,e,f){if(br(a),bs(b),!aY(c,Response))throw a_('"response" must be an instance of Response',a$);await bK(c,200,"Token Endpoint"),cl(c);let g=await cw(c);if(bj(g.access_token,'"response" body "access_token" property',b9,{body:g}),bj(g.token_type,'"response" body "token_type" property',b9,{body:g}),g.token_type=g.token_type.toLowerCase(),void 0!==g.expires_in){let a="number"!=typeof g.expires_in?parseFloat(g.expires_in):g.expires_in;bi(a,!0,'"response" body "expires_in" property',b9,{body:g}),g.expires_in=a}if(void 0!==g.refresh_token&&bj(g.refresh_token,'"response" body "refresh_token" property',b9,{body:g}),void 0!==g.scope&&"string"!=typeof g.scope)throw bb('"response" body "scope" property must be a string',b9,{body:g});if(void 0!==g.id_token){bj(g.id_token,'"response" body "id_token" property',b9,{body:g});let f=["aud","exp","iat","iss","sub"];!0===b.require_auth_time&&f.push("auth_time"),void 0!==b.default_max_age&&(bi(b.default_max_age,!0,'"client.default_max_age"'),f.push("auth_time")),d?.length&&f.push(...d);let{claims:h,jwt:i}=await cn(g.id_token,co.bind(void 0,b.id_token_signed_response_alg,a.id_token_signing_alg_values_supported,"RS256"),bo(b),bp(b),e).then(b$.bind(void 0,f)).then(bV.bind(void 0,a)).then(bU.bind(void 0,b.client_id));if(Array.isArray(h.aud)&&1!==h.aud.length){if(void 0===h.azp)throw bb('ID Token "aud" (audience) claim includes additional untrusted audiences',cf,{claims:h,claim:"aud"});if(h.azp!==b.client_id)throw bb('unexpected ID Token "azp" (authorized party) claim value',cf,{expected:b.client_id,claims:h,claim:"azp"})}void 0!==h.auth_time&&bi(h.auth_time,!0,'ID Token "auth_time" (authentication time)',b9,{claims:h}),bQ.set(c,i),bP.set(g,h)}if(f?.[g.token_type]!==void 0)f[g.token_type](c,g);else if("dpop"!==g.token_type&&"bearer"!==g.token_type)throw new a9("unsupported `token_type` value",{cause:{body:g}});return g}async function bT(a,b,c,d){return bS(a,b,c,void 0,d?.[a4],d?.recognizedTokenTypes)}function bU(a,b){if(Array.isArray(b.claims.aud)){if(!b.claims.aud.includes(a))throw bb('unexpected JWT "aud" (audience) claim value',cf,{expected:a,claims:b.claims,claim:"aud"})}else if(b.claims.aud!==a)throw bb('unexpected JWT "aud" (audience) claim value',cf,{expected:a,claims:b.claims,claim:"aud"});return b}function bV(a,b){let c=a[cy]?.(b)??a.issuer;if(b.claims.iss!==c)throw bb('unexpected JWT "iss" (issuer) claim value',cf,{expected:c,claims:b.claims,claim:"iss"});return b}let bW=new WeakSet,bX=Symbol();async function bY(a,b,c,d,e,f,g){if(br(a),bs(b),!bW.has(d))throw a_('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',aZ);bj(e,'"redirectUri"');let h=cp(d,"code");if(!h)throw bb('no authorization code in "callbackParameters"',b9);let i=new URLSearchParams(g?.additionalParameters);return i.set("redirect_uri",e),i.set("code",h),f!==bX&&(bj(f,'"codeVerifier"'),i.set("code_verifier",f)),bN(a,b,c,"authorization_code",i,g)}let bZ={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function b$(a,b){for(let c of a)if(void 0===b.claims[c])throw bb(`JWT "${c}" (${bZ[c]}) claim missing`,b9,{claims:b.claims});return b}let b_=Symbol(),b0=Symbol();async function b1(a,b,c,d){return"string"==typeof d?.expectedNonce||"number"==typeof d?.maxAge||d?.requireIdToken?b2(a,b,c,d.expectedNonce,d.maxAge,d[a4],d.recognizedTokenTypes):b3(a,b,c,d?.[a4],d?.recognizedTokenTypes)}async function b2(a,b,c,d,e,f,g){let h=[];switch(d){case void 0:d=b_;break;case b_:break;default:bj(d,'"expectedNonce" argument'),h.push("nonce")}switch(e??=b.default_max_age){case void 0:e=b0;break;case b0:break;default:bi(e,!0,'"maxAge" argument'),h.push("auth_time")}let i=await bS(a,b,c,h,f,g);bj(i.id_token,'"response" body "id_token" property',b9,{body:i});let j=bR(i);if(e!==b0){let a=bq()+bo(b),c=bp(b);if(j.auth_time+e<a-c)throw bb("too much time has elapsed since the last End-User authentication",ce,{claims:j,now:a,tolerance:c,claim:"auth_time"})}if(d===b_){if(void 0!==j.nonce)throw bb('unexpected ID Token "nonce" claim value',cf,{expected:void 0,claims:j,claim:"nonce"})}else if(j.nonce!==d)throw bb('unexpected ID Token "nonce" claim value',cf,{expected:d,claims:j,claim:"nonce"});return i}async function b3(a,b,c,d,e){let f=await bS(a,b,c,void 0,d,e),g=bR(f);if(g){if(void 0!==b.default_max_age){bi(b.default_max_age,!0,'"client.default_max_age"');let a=bq()+bo(b),c=bp(b);if(g.auth_time+b.default_max_age<a-c)throw bb("too much time has elapsed since the last End-User authentication",ce,{claims:g,now:a,tolerance:c,claim:"auth_time"})}if(void 0!==g.nonce)throw bb('unexpected ID Token "nonce" claim value',cf,{expected:void 0,claims:g,claim:"nonce"})}return f}let b4="OAUTH_WWW_AUTHENTICATE_CHALLENGE",b5="OAUTH_RESPONSE_BODY_ERROR",b6="OAUTH_UNSUPPORTED_OPERATION",b7="OAUTH_AUTHORIZATION_RESPONSE_ERROR",b8="OAUTH_PARSE_ERROR",b9="OAUTH_INVALID_RESPONSE",ca="OAUTH_RESPONSE_IS_NOT_JSON",cb="OAUTH_RESPONSE_IS_NOT_CONFORM",cc="OAUTH_HTTP_REQUEST_FORBIDDEN",cd="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",ce="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",cf="OAUTH_JWT_CLAIM_COMPARISON_FAILED",cg="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",ch="OAUTH_MISSING_SERVER_METADATA",ci="OAUTH_INVALID_SERVER_METADATA";async function cj(a,b,c,d,e,f){return br(a),bs(b),bj(d,'"grantType"'),bN(a,b,c,d,new URLSearchParams(e),f)}async function ck(a,b,c,d){return bS(a,b,c,void 0,d?.[a4],d?.recognizedTokenTypes)}function cl(a){if(a.bodyUsed)throw a_('"response" body has been used already',aZ)}function cm(a){let{algorithm:b}=a;if("number"!=typeof b.modulusLength||b.modulusLength<2048)throw new a9(`unsupported ${b.name} modulusLength`,{cause:a})}async function cn(a,b,c,d,e){let f,g,{0:h,1:i,length:j}=a.split(".");if(5===j)if(void 0!==e)a=await e(a),{0:h,1:i,length:j}=a.split(".");else throw new a9("JWE decryption is not configured",{cause:a});if(3!==j)throw bb("Invalid JWT",b9,a);try{f=JSON.parse(a7(a8(h)))}catch(a){throw bb("failed to parse JWT Header body as base64url encoded JSON",b8,a)}if(!bc(f))throw bb("JWT Header must be a top level object",b9,a);if(b(f),void 0!==f.crit)throw new a9('no JWT "crit" header parameter extensions are supported',{cause:{header:f}});try{g=JSON.parse(a7(a8(i)))}catch(a){throw bb("failed to parse JWT Payload body as base64url encoded JSON",b8,a)}if(!bc(g))throw bb("JWT Payload must be a top level object",b9,a);let k=bq()+c;if(void 0!==g.exp){if("number"!=typeof g.exp)throw bb('unexpected JWT "exp" (expiration time) claim type',b9,{claims:g});if(g.exp<=k-d)throw bb('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',ce,{claims:g,now:k,tolerance:d,claim:"exp"})}if(void 0!==g.iat&&"number"!=typeof g.iat)throw bb('unexpected JWT "iat" (issued at) claim type',b9,{claims:g});if(void 0!==g.iss&&"string"!=typeof g.iss)throw bb('unexpected JWT "iss" (issuer) claim type',b9,{claims:g});if(void 0!==g.nbf){if("number"!=typeof g.nbf)throw bb('unexpected JWT "nbf" (not before) claim type',b9,{claims:g});if(g.nbf>k+d)throw bb('unexpected JWT "nbf" (not before) claim value',ce,{claims:g,now:k,tolerance:d,claim:"nbf"})}if(void 0!==g.aud&&"string"!=typeof g.aud&&!Array.isArray(g.aud))throw bb('unexpected JWT "aud" (audience) claim type',b9,{claims:g});return{header:f,claims:g,jwt:a}}function co(a,b,c,d){if(void 0!==a){if("string"==typeof a?d.alg!==a:!a.includes(d.alg))throw bb('unexpected JWT "alg" header parameter',b9,{header:d,expected:a,reason:"client configuration"});return}if(Array.isArray(b)){if(!b.includes(d.alg))throw bb('unexpected JWT "alg" header parameter',b9,{header:d,expected:b,reason:"authorization server metadata"});return}if(void 0!==c){if("string"==typeof c?d.alg!==c:"function"==typeof c?!c(d.alg):!c.includes(d.alg))throw bb('unexpected JWT "alg" header parameter',b9,{header:d,expected:c,reason:"default value"});return}throw bb('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:a,issuer:b,fallback:c})}function cp(a,b){let{0:c,length:d}=a.getAll(b);if(d>1)throw bb(`"${b}" parameter must be provided only once`,b9);return c}let cq=Symbol(),cr=Symbol();async function cs(a,b,c,d,e){br(a),bs(b);let f=by(a,"backchannel_authentication_endpoint",b.use_mtls_endpoint_aliases,e?.[a0]!==!0),g=new URLSearchParams(d);g.set("client_id",b.client_id);let h=bd(e?.headers);return h.set("accept","application/json"),bM(a,b,c,f,g,h,e)}async function ct(a,b,c){if(br(a),bs(b),!aY(c,Response))throw a_('"response" must be an instance of Response',a$);await bK(c,200,"Backchannel Authentication Endpoint"),cl(c);let d=await cw(c);bj(d.auth_req_id,'"response" body "auth_req_id" property',b9,{body:d});let e="number"!=typeof d.expires_in?parseFloat(d.expires_in):d.expires_in;return bi(e,!0,'"response" body "expires_in" property',b9,{body:d}),d.expires_in=e,void 0!==d.interval&&bi(d.interval,!1,'"response" body "interval" property',b9,{body:d}),d}async function cu(a,b,c,d,e){br(a),bs(b),bj(d,'"authReqId"');let f=new URLSearchParams(e?.additionalParameters);return f.set("auth_req_id",d),bN(a,b,c,"urn:openid:params:grant-type:ciba",f,e)}async function cv(a,b,c,d){return bS(a,b,c,void 0,d?.[a4],d?.recognizedTokenTypes)}async function cw(a,b=bl){let c;try{c=await a.json()}catch(c){throw b(a),bb('failed to parse "response" body as JSON',b8,c)}if(!bc(c))throw bb('"response" body must be a top level object',b9,{body:c});return c}let cx=Symbol(),cy=Symbol();"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(i={"user-agent":"openid-client/v6.8.0"});let cz=a=>j.get(a),cA="ERR_INVALID_ARG_VALUE",cB="ERR_INVALID_ARG_TYPE";function cC(a,b,c){let d=TypeError(a,{cause:c});return Object.assign(d,{code:b}),d}class cD extends Error{code;constructor(a,b){super(a,b),this.name=this.constructor.name,this.code=b?.code,Error.captureStackTrace?.(this,this.constructor)}}function cE(a,b,c){return new cD(a,{cause:b,code:c})}function cF(a){if(a instanceof TypeError||a instanceof cD||a instanceof bA||a instanceof bB||a instanceof bC)throw a;if(a instanceof ba)switch(a.code){case cc:throw cE("only requests to HTTPS are allowed",a,a.code);case cd:throw cE("only requests to HTTP or HTTPS are allowed",a,a.code);case cb:throw cE("unexpected HTTP response status code",a.cause,a.code);case ca:throw cE("unexpected response content-type",a.cause,a.code);case b8:throw cE("parsing error occured",a,a.code);case b9:throw cE("invalid response encountered",a,a.code);case cf:throw cE("unexpected JWT claim value encountered",a,a.code);case cg:throw cE("unexpected JSON attribute value encountered",a,a.code);case ce:throw cE("JWT timestamp claim value failed validation",a,a.code);default:throw cE(a.message,a,a.code)}if(a instanceof a9)throw cE("unsupported operation",a,a.code);if(a instanceof DOMException)switch(a.name){case"OperationError":throw cE("runtime operation error",a,b6);case"NotSupportedError":throw cE("runtime unsupported operation",a,b6);case"TimeoutError":throw cE("operation timed out",a,"OAUTH_TIMEOUT");case"AbortError":throw cE("operation aborted",a,"OAUTH_ABORT")}throw new cD("something went wrong",{cause:a})}new TextDecoder;let cG=Symbol();class cH{constructor(a,b,c,d){let e;if("string"!=typeof b||!b.length)throw cC('"clientId" must be a non-empty string',cB);if("string"==typeof c&&(c={client_secret:c}),c?.client_id!==void 0&&b!==c.client_id)throw cC('"clientId" and "metadata.client_id" must be the same',cA);let f={...structuredClone(c),client_id:b};f[a1]=c?.[a1]??0,f[a2]=c?.[a2]??30,e=d||("string"==typeof f.client_secret&&f.client_secret.length?function(a){return void 0!==a?bt(a):(k||=new WeakMap,(a,b,c,d)=>{let e;return(e=k.get(b))||(function(a,b){if("string"!=typeof a)throw cC(`${b} must be a string`,cB);if(0===a.length)throw cC(`${b} must not be empty`,cA)}(b.client_secret,'"metadata.client_secret"'),e=bt(b.client_secret),k.set(b,e)),e(a,b,c,d)})}(f.client_secret):(a,b,c,d)=>{c.set("client_id",b.client_id)});let g=Object.freeze(f),h=structuredClone(a);cG in a&&(h[cy]=({claims:{tid:b}})=>a.issuer.replace("{tenantid}",b));let i=Object.freeze(h);(j||=new WeakMap).set(this,{__proto__:null,as:i,c:g,auth:e,tlsOnly:!0,jwksCache:{}})}serverMetadata(){let a=structuredClone(cz(this).as);return Object.defineProperties(a,{supportsPKCE:{__proto__:null,value:(b="S256")=>a.code_challenge_methods_supported?.includes(b)===!0}}),a}clientMetadata(){return structuredClone(cz(this).c)}get timeout(){return cz(this).timeout}set timeout(a){cz(this).timeout=a}get[a3](){return cz(this).fetch}set[a3](a){cz(this).fetch=a}}async function cI(a,b,c,d=!1){let e,f=a.headers.get("retry-after")?.trim();if(void 0!==f){if(/^\d+$/.test(f))e=parseInt(f,10);else{let a=new Date(f);if(Number.isFinite(a.getTime())){let b=new Date,c=a.getTime()-b.getTime();c>0&&(e=Math.ceil(c/1e3))}}if(d&&!Number.isFinite(e))throw new ba("invalid Retry-After header value",{cause:a});e>b&&await cJ(e-b,c)}}function cJ(a,b){return new Promise((c,d)=>{let e=a=>{try{b.throwIfAborted()}catch(a){d(a);return}if(a<=0)return void c();let f=Math.min(a,5);setTimeout(()=>e(a-f),1e3*f)};e(a)})}async function cK(a,b){cM(a);let{as:c,c:d,auth:e,fetch:f,tlsOnly:g,timeout:h}=cz(a);return cs(c,d,e,b,{[a3]:f,[a0]:!g,headers:new Headers(i),signal:cN(h)}).then(a=>ct(c,d,a)).catch(cF)}async function cL(a,b,c,d){var e;let f;cM(a),c=new URLSearchParams(c);let g=b.interval??5,h=d?.signal??AbortSignal.timeout(1e3*b.expires_in);try{await cJ(g,h)}catch(a){cF(a)}let{as:j,c:k,auth:l,fetch:m,tlsOnly:n,nonRepudiation:o,timeout:p,decrypt:q}=cz(a),r=(e,f)=>cL(a,{...b,interval:e},c,{...d,signal:h,flag:f}),s=await cu(j,k,l,b.auth_req_id,{[a3]:m,[a0]:!n,additionalParameters:c,DPoP:d?.DPoP,headers:new Headers(i),signal:h.aborted?h:cN(p)}).catch(cF);if(503===s.status&&s.headers.has("retry-after"))return await cI(s,g,h,!0),await s.body?.cancel(),r(g);let t=cv(j,k,s,{[a4]:q});try{f=await t}catch(a){if(function(a,b){if(b?.DPoP&&b.flag!==cO){if(a instanceof bC){let{0:b,length:c}=a.cause;return 1===c&&"dpop"===b.scheme&&"use_dpop_nonce"===b.parameters.error}return a instanceof bA&&"use_dpop_nonce"===a.error}return!1}(a,d))return r(g,cO);if(a instanceof bA)switch(a.error){case"slow_down":g+=5;case"authorization_pending":return await cI(a.response,g,h),r(g)}cF(a)}return f.id_token&&await o?.(s),Object.defineProperties(e=f,function(a){let b;if(void 0!==a.expires_in){let c=new Date;c.setSeconds(c.getSeconds()+a.expires_in),b=c.getTime()}return{expiresIn:{__proto__:null,value(){if(b){let a=Date.now();return b>a?Math.floor((b-a)/1e3):0}}},claims:{__proto__:null,value(){try{return bR(this)}catch{return}}}}}(e)),f}function cM(a){if(!(a instanceof cH))throw cC('"config" must be an instance of Configuration',cB);if(Object.getPrototypeOf(a)!==cH.prototype)throw cC("subclassing Configuration is not allowed",cA)}function cN(a){return a?AbortSignal.timeout(1e3*a):void 0}Object.freeze(cH.prototype);let cO=Symbol(),cP={rE:"4.10.0"};function cQ(a){return a&&!a.endsWith("/")?`${a}/`:a}function cR(a){return a&&a.startsWith("/")?a.substring(1,a.length):a}function cS(a){var b;let c=["path"in a&&a.path&&`Path=${a.path}`,"expires"in a&&(a.expires||0===a.expires)&&`Expires=${("number"==typeof a.expires?new Date(a.expires):a.expires).toUTCString()}`,"maxAge"in a&&"number"==typeof a.maxAge&&`Max-Age=${a.maxAge}`,"domain"in a&&a.domain&&`Domain=${a.domain}`,"secure"in a&&a.secure&&"Secure","httpOnly"in a&&a.httpOnly&&"HttpOnly","sameSite"in a&&a.sameSite&&`SameSite=${a.sameSite}`,"partitioned"in a&&a.partitioned&&"Partitioned","priority"in a&&a.priority&&`Priority=${a.priority}`].filter(Boolean),d=`${a.name}=${encodeURIComponent(null!=(b=a.value)?b:"")}`;return 0===c.length?d:`${d}; ${c.join("; ")}`}function cT(a){let b=new Map;for(let c of a.split(/; */)){if(!c)continue;let a=c.indexOf("=");if(-1===a){b.set(c,"true");continue}let[d,e]=[c.slice(0,a),c.slice(a+1)];try{b.set(d,decodeURIComponent(null!=e?e:"true"))}catch{}}return b}!function(a){a.SUBJECT_TYPE_REFRESH_TOKEN="urn:ietf:params:oauth:token-type:refresh_token",a.SUBJECT_TYPE_ACCESS_TOKEN="urn:ietf:params:oauth:token-type:access_token"}(o||(o={}));var cU=["strict","lax","none"],cV=["low","medium","high"],cW=class{constructor(a){this._parsed=new Map,this._headers=a;let b=a.get("cookie");if(b)for(let[a,c]of cT(b))this._parsed.set(a,{name:a,value:c})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...a){let b="string"==typeof a[0]?a[0]:a[0].name;return this._parsed.get(b)}getAll(...a){var b;let c=Array.from(this._parsed);if(!a.length)return c.map(([a,b])=>b);let d="string"==typeof a[0]?a[0]:null==(b=a[0])?void 0:b.name;return c.filter(([a])=>a===d).map(([a,b])=>b)}has(a){return this._parsed.has(a)}set(...a){let[b,c]=1===a.length?[a[0].name,a[0].value]:a,d=this._parsed;return d.set(b,{name:b,value:c}),this._headers.set("cookie",Array.from(d).map(([a,b])=>cS(b)).join("; ")),this}delete(a){let b=this._parsed,c=Array.isArray(a)?a.map(a=>b.delete(a)):b.delete(a);return this._headers.set("cookie",Array.from(b).map(([a,b])=>cS(b)).join("; ")),c}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(a=>`${a.name}=${encodeURIComponent(a.value)}`).join("; ")}},cX=class{constructor(a){var b,c,d;this._parsed=new Map,this._headers=a;let e=null!=(d=null!=(c=null==(b=a.getSetCookie)?void 0:b.call(a))?c:a.get("set-cookie"))?d:[];for(let a of Array.isArray(e)?e:function(a){if(!a)return[];var b,c,d,e,f,g=[],h=0;function i(){for(;h<a.length&&/\s/.test(a.charAt(h));)h+=1;return h<a.length}for(;h<a.length;){for(b=h,f=!1;i();)if(","===(c=a.charAt(h))){for(d=h,h+=1,i(),e=h;h<a.length&&"="!==(c=a.charAt(h))&&";"!==c&&","!==c;)h+=1;h<a.length&&"="===a.charAt(h)?(f=!0,h=e,g.push(a.substring(b,d)),b=h):h=d+1}else h+=1;(!f||h>=a.length)&&g.push(a.substring(b,a.length))}return g}(e)){let b=function(a){if(!a)return;let[[b,c],...d]=cT(a),{domain:e,expires:f,httponly:g,maxage:h,path:i,samesite:j,secure:k,partitioned:l,priority:m}=Object.fromEntries(d.map(([a,b])=>[a.toLowerCase().replace(/-/g,""),b]));{var n,o,p={name:b,value:decodeURIComponent(c),domain:e,...f&&{expires:new Date(f)},...g&&{httpOnly:!0},..."string"==typeof h&&{maxAge:Number(h)},path:i,...j&&{sameSite:(n=(n=j).toLowerCase(),cU.includes(n)?n:void 0)},...k&&{secure:!0},...m&&{priority:(o=(o=m).toLowerCase(),cV.includes(o)?o:void 0)},...l&&{partitioned:!0}};let a={};for(let b in p)p[b]&&(a[b]=p[b]);return a}}(a);b&&this._parsed.set(b.name,b)}}get(...a){let b="string"==typeof a[0]?a[0]:a[0].name;return this._parsed.get(b)}getAll(...a){var b;let c=Array.from(this._parsed.values());if(!a.length)return c;let d="string"==typeof a[0]?a[0]:null==(b=a[0])?void 0:b.name;return c.filter(a=>a.name===d)}has(a){return this._parsed.has(a)}set(...a){let[b,c,d]=1===a.length?[a[0].name,a[0].value,a[0]]:a,e=this._parsed;return e.set(b,function(a={name:"",value:""}){return"number"==typeof a.expires&&(a.expires=new Date(a.expires)),a.maxAge&&(a.expires=new Date(Date.now()+1e3*a.maxAge)),(null===a.path||void 0===a.path)&&(a.path="/"),a}({name:b,value:c,...d})),function(a,b){for(let[,c]of(b.delete("set-cookie"),a)){let a=cS(c);b.append("set-cookie",a)}}(e,this._headers),this}delete(...a){let[b,c]="string"==typeof a[0]?[a[0]]:[a[0].name,a[0]];return this.set({...c,name:b,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(cS).join("; ")}},cY=c(5511);"function"!=typeof cY.hkdf||process.versions.electron||(l=async(...a)=>new Promise((b,c)=>{cY.hkdf(...a,(a,d)=>{a?c(a):b(new Uint8Array(d))})}));let cZ=async(a,b,c,d,e)=>(l||((a,b,c,d,e)=>{let f=parseInt(a.substr(3),10)>>3||20,g=(0,cY.createHmac)(a,c.byteLength?c:new Uint8Array(f)).update(b).digest(),h=Math.ceil(e/f),i=new Uint8Array(f*h+d.byteLength+1),j=0,k=0;for(let b=1;b<=h;b++)i.set(d,k),i[k+d.byteLength]=b,i.set((0,cY.createHmac)(a,g).update(i.subarray(j,k+d.byteLength+1)).digest(),k),j=k,k+=f;return i.slice(0,e)}))(a,b,c,d,e);function c$(a,b){if("string"==typeof a)return new TextEncoder().encode(a);if(!(a instanceof Uint8Array))throw TypeError(`"${b}"" must be an instance of Uint8Array or a string`);return a}async function c_(a,b,c,d,e){return cZ(function(a){switch(a){case"sha256":case"sha384":case"sha512":case"sha1":return a;default:throw TypeError('unsupported "digest" value')}}(a),function(a){let b=c$(a,"ikm");if(!b.byteLength)throw TypeError('"ikm" must be at least one byte in length');return b}(b),c$(c,"salt"),function(a){let b=c$(a,"info");if(b.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return b}(d),function(a,b){if("number"!=typeof a||!Number.isInteger(a)||a<1)throw TypeError('"keylen" must be a positive integer');if(a>255*(parseInt(b.substr(3),10)>>3||20))throw TypeError('"keylen" too large');return a}(e,a))}let c0=Symbol();function c1(a){switch(a){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new I(`Unsupported JWE Algorithm: ${a}`)}}let c2=(a,b)=>{if(b.length<<3!==c1(a))throw new K("Invalid Initialization Vector length")},c3=(a,b)=>{let c=a.byteLength<<3;if(c!==b)throw new K(`Invalid Content Encryption Key length. Expected ${b} bits, got ${c} bits`)};async function c4(a,b,c,d,e){if(!(c instanceof Uint8Array))throw TypeError(ax(c,"Uint8Array"));let f=parseInt(a.slice(1,4),10),g=await crypto.subtle.importKey("raw",c.subarray(f>>3),"AES-CBC",!1,["encrypt"]),h=await crypto.subtle.importKey("raw",c.subarray(0,f>>3),{hash:`SHA-${f<<1}`,name:"HMAC"},!1,["sign"]),i=new Uint8Array(await crypto.subtle.encrypt({iv:d,name:"AES-CBC"},g,b)),j=U(e,d,i,W(e.length<<3));return{ciphertext:i,tag:new Uint8Array((await crypto.subtle.sign("HMAC",h,j)).slice(0,f>>3)),iv:d}}async function c5(a,b,c,d,e){let f;c instanceof Uint8Array?f=await crypto.subtle.importKey("raw",c,"AES-GCM",!1,["encrypt"]):(av(c,a,"encrypt"),f=c);let g=new Uint8Array(await crypto.subtle.encrypt({additionalData:e,iv:d,name:"AES-GCM",tagLength:128},f,b)),h=g.slice(-16);return{ciphertext:g.slice(0,-16),tag:h,iv:d}}let c6=async(a,b,c,d,e)=>{if(!aD(c)&&!(c instanceof Uint8Array))throw TypeError(ax(c,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(d)c2(a,d);else d=crypto.getRandomValues(new Uint8Array(c1(a)>>3));switch(a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return c instanceof Uint8Array&&c3(c,parseInt(a.slice(-3),10)),c4(a,b,c,d,e);case"A128GCM":case"A192GCM":case"A256GCM":return c instanceof Uint8Array&&c3(c,parseInt(a.slice(1,4),10)),c5(a,b,c,d,e);default:throw new I("Unsupported JWE Content Encryption Algorithm")}};function c7(a,b){if(a.algorithm.length!==parseInt(b.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${b}`)}function c8(a,b,c){return a instanceof Uint8Array?crypto.subtle.importKey("raw",a,"AES-KW",!0,[c]):(av(a,b,c),a)}async function c9(a,b,c){let d=await c8(b,a,"wrapKey");c7(d,a);let e=await crypto.subtle.importKey("raw",c,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",e,d,"AES-KW"))}async function da(a,b,c){let d=await c8(b,a,"unwrapKey");c7(d,a);let e=await crypto.subtle.unwrapKey("raw",c,d,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",e))}let db=async(a,b)=>{let c=`SHA-${a.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(c,b))};function dc(a){return U(X(a.length),a)}async function dd(a,b,c){let d=b>>3,e=Math.ceil(d/32),f=new Uint8Array(32*e);for(let b=1;b<=e;b++){let d=new Uint8Array(4+a.length+c.length);d.set(X(b),0),d.set(a,4),d.set(c,4+a.length);let e=await db("sha256",d);f.set(e,(b-1)*32)}return f.slice(0,d)}async function de(a,b,c,d,e=new Uint8Array(0),f=new Uint8Array(0)){var g;av(a,"ECDH"),av(b,"ECDH","deriveBits");let h=dc(S.encode(c)),i=dc(e),j=dc(f),k=U(h,i,j,X(d),new Uint8Array(0));return dd(new Uint8Array(await crypto.subtle.deriveBits({name:a.algorithm.name,public:a},b,"X25519"===(g=a).algorithm.name?256:Math.ceil(parseInt(g.algorithm.namedCurve.slice(-3),10)/8)<<3)),d,k)}function df(a){switch(a.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===a.algorithm.name}}async function dg(a,b,c,d){if(!(a instanceof Uint8Array)||a.length<8)throw new K("PBES2 Salt Input must be 8 or more octets");let e=U(S.encode(b),new Uint8Array([0]),a),f=parseInt(b.slice(13,16),10),g={hash:`SHA-${b.slice(8,11)}`,iterations:c,name:"PBKDF2",salt:e},h=await (d instanceof Uint8Array?crypto.subtle.importKey("raw",d,"PBKDF2",!1,["deriveBits"]):(av(d,b,"deriveBits"),d));return new Uint8Array(await crypto.subtle.deriveBits(g,h,f))}async function dh(a,b,c,d=2048,e=crypto.getRandomValues(new Uint8Array(16))){let f=await dg(e,a,d,b);return{encryptedKey:await c9(a.slice(-6),f,c),p2c:d,p2s:$(e)}}async function di(a,b,c,d,e){let f=await dg(e,a,d,b);return da(a.slice(-6),f,c)}let dj=a=>{switch(a){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new I(`alg ${a} is not supported either by JOSE or your javascript runtime`)}};async function dk(a,b,c){return av(b,a,"encrypt"),aq(a,b),new Uint8Array(await crypto.subtle.encrypt(dj(a),b,c))}async function dl(a,b,c){return av(b,a,"decrypt"),aq(a,b),new Uint8Array(await crypto.subtle.decrypt(dj(a),b,c))}function dm(a){switch(a){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new I(`Unsupported JWE Algorithm: ${a}`)}}let dn=a=>crypto.getRandomValues(new Uint8Array(dm(a)>>3));async function dp(a){if(aE(a))if("secret"!==a.type)return a.export({format:"jwk"});else a=a.export();if(a instanceof Uint8Array)return{kty:"oct",k:$(a)};if(!aD(a))throw TypeError(ax(a,"CryptoKey","KeyObject","Uint8Array"));if(!a.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:b,key_ops:c,alg:d,use:e,...f}=await crypto.subtle.exportKey("jwk",a);return"AKP"===f.kty&&(f.alg=d),f}async function dq(a){return dp(a)}async function dr(a,b){if(!(a instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(b instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let c={name:"HMAC",hash:"SHA-256"},d=await crypto.subtle.generateKey(c,!1,["sign"]),e=new Uint8Array(await crypto.subtle.sign(c,d,a)),f=new Uint8Array(await crypto.subtle.sign(c,d,b)),g=0,h=-1;for(;++h<32;)g|=e[h]^f[h];return 0===g}async function ds(a,b,c,d,e,f){let g,h;if(!(b instanceof Uint8Array))throw TypeError(ax(b,"Uint8Array"));let i=parseInt(a.slice(1,4),10),j=await crypto.subtle.importKey("raw",b.subarray(i>>3),"AES-CBC",!1,["decrypt"]),k=await crypto.subtle.importKey("raw",b.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),l=U(f,d,c,W(f.length<<3)),m=new Uint8Array((await crypto.subtle.sign("HMAC",k,l)).slice(0,i>>3));try{g=await dr(e,m)}catch{}if(!g)throw new J;try{h=new Uint8Array(await crypto.subtle.decrypt({iv:d,name:"AES-CBC"},j,c))}catch{}if(!h)throw new J;return h}async function dt(a,b,c,d,e,f){let g;b instanceof Uint8Array?g=await crypto.subtle.importKey("raw",b,"AES-GCM",!1,["decrypt"]):(av(b,a,"decrypt"),g=b);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:f,iv:d,name:"AES-GCM",tagLength:128},g,U(c,e)))}catch{throw new J}}let du=async(a,b,c,d,e,f)=>{if(!aD(b)&&!(b instanceof Uint8Array))throw TypeError(ax(b,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!d)throw new K("JWE Initialization Vector missing");if(!e)throw new K("JWE Authentication Tag missing");switch(c2(a,d),a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return b instanceof Uint8Array&&c3(b,parseInt(a.slice(-3),10)),ds(a,b,c,d,e,f);case"A128GCM":case"A192GCM":case"A256GCM":return b instanceof Uint8Array&&c3(b,parseInt(a.slice(1,4),10)),dt(a,b,c,d,e,f);default:throw new I("Unsupported JWE Content Encryption Algorithm")}};async function dv(a,b,c,d){let e=a.slice(0,7),f=await c6(e,c,b,d,new Uint8Array(0));return{encryptedKey:f.ciphertext,iv:$(f.iv),tag:$(f.tag)}}async function dw(a,b,c,d,e){return du(a.slice(0,7),b,c,d,e,new Uint8Array(0))}let dx=async(a,b,c,d,e={})=>{let f,g,h;switch(a){case"dir":h=c;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i;if(aC(c),!df(c))throw new I("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:j,apv:k}=e;i=e.epk?await aN(e.epk,a):(await crypto.subtle.generateKey(c.algorithm,!0,["deriveBits"])).privateKey;let{x:l,y:m,crv:n,kty:o}=await dq(i),p=await de(c,i,"ECDH-ES"===a?b:a,"ECDH-ES"===a?dm(b):parseInt(a.slice(-5,-2),10),j,k);if(g={epk:{x:l,crv:n,kty:o}},"EC"===o&&(g.epk.y=m),j&&(g.apu=$(j)),k&&(g.apv=$(k)),"ECDH-ES"===a){h=p;break}h=d||dn(b);let q=a.slice(-6);f=await c9(q,p,h);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":h=d||dn(b),aC(c),f=await dk(a,c,h);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{h=d||dn(b);let{p2c:i,p2s:j}=e;({encryptedKey:f,...g}=await dh(a,c,h,i,j));break}case"A128KW":case"A192KW":case"A256KW":h=d||dn(b),f=await c9(a,c,h);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{h=d||dn(b);let{iv:i}=e;({encryptedKey:f,...g}=await dv(a,c,h,i));break}default:throw new I('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:h,encryptedKey:f,parameters:g}};class dy{#n;#o;#p;#q;#r;#s;#t;#u;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#n=a}setKeyManagementParameters(a){if(this.#u)throw TypeError("setKeyManagementParameters can only be called once");return this.#u=a,this}setProtectedHeader(a){if(this.#o)throw TypeError("setProtectedHeader can only be called once");return this.#o=a,this}setSharedUnprotectedHeader(a){if(this.#p)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#p=a,this}setUnprotectedHeader(a){if(this.#q)throw TypeError("setUnprotectedHeader can only be called once");return this.#q=a,this}setAdditionalAuthenticatedData(a){return this.#r=a,this}setContentEncryptionKey(a){if(this.#s)throw TypeError("setContentEncryptionKey can only be called once");return this.#s=a,this}setInitializationVector(a){if(this.#t)throw TypeError("setInitializationVector can only be called once");return this.#t=a,this}async encrypt(a,b){let c,d,e,f,g;if(!this.#o&&!this.#q&&!this.#p)throw new K("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!aB(this.#o,this.#q,this.#p))throw new K("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let h={...this.#o,...this.#q,...this.#p};if(aK(K,new Map,b?.crit,this.#o,h),void 0!==h.zip)throw new I('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:i,enc:j}=h;if("string"!=typeof i||!i)throw new K('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof j||!j)throw new K('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#s&&("dir"===i||"ECDH-ES"===i))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${i}`);aJ("dir"===i?j:i,a,"encrypt");{let e,f=await aN(a,i);({cek:d,encryptedKey:c,parameters:e}=await dx(i,j,f,this.#s,this.#u)),e&&(b&&c0 in b?this.#q?this.#q={...this.#q,...e}:this.setUnprotectedHeader(e):this.#o?this.#o={...this.#o,...e}:this.setProtectedHeader(e))}f=this.#o?S.encode($(JSON.stringify(this.#o))):S.encode(""),this.#r?(g=$(this.#r),e=U(f,S.encode("."),S.encode(g))):e=f;let{ciphertext:k,tag:l,iv:m}=await c6(j,this.#n,d,this.#t,e),n={ciphertext:$(k)};return m&&(n.iv=$(m)),l&&(n.tag=$(l)),c&&(n.encrypted_key=$(c)),g&&(n.aad=g),this.#o&&(n.protected=T.decode(f)),this.#p&&(n.unprotected=this.#p),this.#q&&(n.header=this.#q),n}}class dz{#v;constructor(a){this.#v=new dy(a)}setContentEncryptionKey(a){return this.#v.setContentEncryptionKey(a),this}setInitializationVector(a){return this.#v.setInitializationVector(a),this}setProtectedHeader(a){return this.#v.setProtectedHeader(a),this}setKeyManagementParameters(a){return this.#v.setKeyManagementParameters(a),this}async encrypt(a,b){let c=await this.#v.encrypt(a,b);return[c.protected,c.encrypted_key,c.iv,c.ciphertext,c.tag].join(".")}}class dA{#s;#t;#u;#o;#w;#x;#y;#z;constructor(a={}){this.#z=new aW(a)}setIssuer(a){return this.#z.iss=a,this}setSubject(a){return this.#z.sub=a,this}setAudience(a){return this.#z.aud=a,this}setJti(a){return this.#z.jti=a,this}setNotBefore(a){return this.#z.nbf=a,this}setExpirationTime(a){return this.#z.exp=a,this}setIssuedAt(a){return this.#z.iat=a,this}setProtectedHeader(a){if(this.#o)throw TypeError("setProtectedHeader can only be called once");return this.#o=a,this}setKeyManagementParameters(a){if(this.#u)throw TypeError("setKeyManagementParameters can only be called once");return this.#u=a,this}setContentEncryptionKey(a){if(this.#s)throw TypeError("setContentEncryptionKey can only be called once");return this.#s=a,this}setInitializationVector(a){if(this.#t)throw TypeError("setInitializationVector can only be called once");return this.#t=a,this}replicateIssuerAsHeader(){return this.#w=!0,this}replicateSubjectAsHeader(){return this.#x=!0,this}replicateAudienceAsHeader(){return this.#y=!0,this}async encrypt(a,b){let c=new dz(this.#z.data());return this.#o&&(this.#w||this.#x||this.#y)&&(this.#o={...this.#o,iss:this.#w?this.#z.iss:void 0,sub:this.#x?this.#z.sub:void 0,aud:this.#y?this.#z.aud:void 0}),c.setProtectedHeader(this.#o),this.#t&&c.setInitializationVector(this.#t),this.#s&&c.setContentEncryptionKey(this.#s),this.#u&&c.setKeyManagementParameters(this.#u),c.encrypt(a,b)}}let dB=async(a,b,c,d,e)=>{switch(a){case"dir":if(void 0!==c)throw new K("Encountered unexpected JWE Encrypted Key");return b;case"ECDH-ES":if(void 0!==c)throw new K("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e,f;if(!af(d.epk))throw new K('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(aC(b),!df(b))throw new I("ECDH with the provided key is not allowed or not supported by your javascript runtime");let g=await ah(d.epk,a);if(aC(g),void 0!==d.apu){if("string"!=typeof d.apu)throw new K('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{e=Z(d.apu)}catch{throw new K("Failed to base64url decode the apu")}}if(void 0!==d.apv){if("string"!=typeof d.apv)throw new K('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{f=Z(d.apv)}catch{throw new K("Failed to base64url decode the apv")}}let h=await de(g,b,"ECDH-ES"===a?d.enc:a,"ECDH-ES"===a?dm(d.enc):parseInt(a.slice(-5,-2),10),e,f);if("ECDH-ES"===a)return h;if(void 0===c)throw new K("JWE Encrypted Key missing");return da(a.slice(-6),h,c)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===c)throw new K("JWE Encrypted Key missing");return aC(b),dl(a,b,c);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let f;if(void 0===c)throw new K("JWE Encrypted Key missing");if("number"!=typeof d.p2c)throw new K('JOSE Header "p2c" (PBES2 Count) missing or invalid');let g=e?.maxPBES2Count||1e4;if(d.p2c>g)throw new K('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof d.p2s)throw new K('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{f=Z(d.p2s)}catch{throw new K("Failed to base64url decode the p2s")}return di(a,b,c,d.p2c,f)}case"A128KW":case"A192KW":case"A256KW":if(void 0===c)throw new K("JWE Encrypted Key missing");return da(a,b,c);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let e,f;if(void 0===c)throw new K("JWE Encrypted Key missing");if("string"!=typeof d.iv)throw new K('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof d.tag)throw new K('JOSE Header "tag" (Authentication Tag) missing or invalid');try{e=Z(d.iv)}catch{throw new K("Failed to base64url decode the iv")}try{f=Z(d.tag)}catch{throw new K("Failed to base64url decode the tag")}return dw(a,b,c,e,f)}default:throw new I('Invalid or unsupported "alg" (JWE Algorithm) header value')}};async function dC(a,b,c){let d,e,f,g,h,i,j;if(!af(a))throw new K("Flattened JWE must be an object");if(void 0===a.protected&&void 0===a.header&&void 0===a.unprotected)throw new K("JOSE Header missing");if(void 0!==a.iv&&"string"!=typeof a.iv)throw new K("JWE Initialization Vector incorrect type");if("string"!=typeof a.ciphertext)throw new K("JWE Ciphertext missing or incorrect type");if(void 0!==a.tag&&"string"!=typeof a.tag)throw new K("JWE Authentication Tag incorrect type");if(void 0!==a.protected&&"string"!=typeof a.protected)throw new K("JWE Protected Header incorrect type");if(void 0!==a.encrypted_key&&"string"!=typeof a.encrypted_key)throw new K("JWE Encrypted Key incorrect type");if(void 0!==a.aad&&"string"!=typeof a.aad)throw new K("JWE AAD incorrect type");if(void 0!==a.header&&!af(a.header))throw new K("JWE Shared Unprotected Header incorrect type");if(void 0!==a.unprotected&&!af(a.unprotected))throw new K("JWE Per-Recipient Unprotected Header incorrect type");if(a.protected)try{let b=Z(a.protected);d=JSON.parse(T.decode(b))}catch{throw new K("JWE Protected Header is invalid")}if(!aB(d,a.header,a.unprotected))throw new K("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let k={...d,...a.header,...a.unprotected};if(aK(K,new Map,c?.crit,d,k),void 0!==k.zip)throw new I('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:l,enc:m}=k;if("string"!=typeof l||!l)throw new K("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof m||!m)throw new K("missing JWE Encryption Algorithm (enc) in JWE Header");let n=c&&aL("keyManagementAlgorithms",c.keyManagementAlgorithms),o=c&&aL("contentEncryptionAlgorithms",c.contentEncryptionAlgorithms);if(n&&!n.has(l)||!n&&l.startsWith("PBES2"))throw new H('"alg" (Algorithm) Header Parameter value not allowed');if(o&&!o.has(m))throw new H('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==a.encrypted_key)try{e=Z(a.encrypted_key)}catch{throw new K("Failed to base64url decode the encrypted_key")}let p=!1;"function"==typeof b&&(b=await b(d,a),p=!0),aJ("dir"===l?m:l,b,"decrypt");let q=await aN(b,l);try{f=await dB(l,q,e,k,c)}catch(a){if(a instanceof TypeError||a instanceof K||a instanceof I)throw a;f=dn(m)}if(void 0!==a.iv)try{g=Z(a.iv)}catch{throw new K("Failed to base64url decode the iv")}if(void 0!==a.tag)try{h=Z(a.tag)}catch{throw new K("Failed to base64url decode the tag")}let r=S.encode(a.protected??"");i=void 0!==a.aad?U(r,S.encode("."),S.encode(a.aad)):r;try{j=Z(a.ciphertext)}catch{throw new K("Failed to base64url decode the ciphertext")}let s={plaintext:await du(m,f,j,g,h,i)};if(void 0!==a.protected&&(s.protectedHeader=d),void 0!==a.aad)try{s.additionalAuthenticatedData=Z(a.aad)}catch{throw new K("Failed to base64url decode the aad")}return(void 0!==a.unprotected&&(s.sharedUnprotectedHeader=a.unprotected),void 0!==a.header&&(s.unprotectedHeader=a.header),p)?{...s,key:q}:s}async function dD(a,b,c){if(a instanceof Uint8Array&&(a=T.decode(a)),"string"!=typeof a)throw new K("Compact JWE must be a string or Uint8Array");let{0:d,1:e,2:f,3:g,4:h,length:i}=a.split(".");if(5!==i)throw new K("Invalid Compact JWE");let j=await dC({ciphertext:g,iv:f||void 0,protected:d,tag:h||void 0,encrypted_key:e||void 0},b,c),k={plaintext:j.plaintext,protectedHeader:j.protectedHeader};return"function"==typeof b?{...k,key:j.key}:k}async function dE(a,b,c){let d=await dD(a,b,c),e=aV(d.protectedHeader,d.plaintext,c),{protectedHeader:f}=d;if(void 0!==f.iss&&f.iss!==e.iss)throw new F('replicated "iss" claim header parameter mismatch',e,"iss","mismatch");if(void 0!==f.sub&&f.sub!==e.sub)throw new F('replicated "sub" claim header parameter mismatch',e,"sub","mismatch");if(void 0!==f.aud&&JSON.stringify(f.aud)!==JSON.stringify(e.aud))throw new F('replicated "aud" claim header parameter mismatch',e,"aud","mismatch");let g={payload:e,protectedHeader:f};return"function"==typeof b?{...g,key:d.key}:g}let dF="sha256",dG="JWE CEK";async function dH(a,b,c,d){let e=await c_(dF,b,"",dG,32);return(await new dA(a).setProtectedHeader({enc:"A256GCM",alg:"dir",...d}).setExpirationTime(c).encrypt(e)).toString()}async function dI(a,b,c){try{let d=await c_(dF,b,"",dG,32);return await dE(a,d,{...c,clockTolerance:15})}catch(a){if("ERR_JWT_EXPIRED"===a.code)return null;throw a}}async function dJ(a,b,c){if(!b)return;let[d,e]=b.split("."),f={protected:$(JSON.stringify({alg:"HS256",b64:!1,crit:["b64"]})),payload:`${a}=${d}`,signature:e},g=await c_("sha256",c,"","JWS Cookie Signing",32);try{return await aO(f,g,{algorithms:["HS256"]}),d}catch(a){return}}let dK=RegExp("__(\\d+)$"),dL=/\.(\d+)$/,dM=(a,b)=>{let c=b?dL.exec(a):dK.exec(a);if(c)return parseInt(c[1],10)},dN=(a,b,c)=>{let d=new RegExp(c?`^${b}${dL.source}$`:`^${b}__\\d+$`);return a.getAll().filter(a=>d.test(a.name))};function dO(a,b,c){let d=b.get(a);if(d?.value)return d.value;let e=dN(b,a,c).sort((a,b)=>dM(a.name,c)-dM(b.name,c));if(0===e.length)return;let f=dM(e[e.length-1].name,c);return e.length!==f+1?void console.warn(`Incomplete chunked cookie '${a}': Found ${e.length} chunks, expected ${f+1}`):e.map(a=>a.value).join("")}function dP(a,b,c,d,e){dR(c,a,e),dN(b,a,d).forEach(a=>{dR(c,a.name,e)})}function dQ(a){a.headers.set("Cache-Control","private, no-cache, no-store, must-revalidate, max-age=0"),a.headers.set("Pragma","no-cache"),a.headers.set("Expires","0")}function dR(a,b,c){let d={maxAge:0};c?.domain&&(d.domain=c.domain),c?.path&&(d.path=c.path),a.set(b,"",d)}let dS=["sub","name","nickname","given_name","family_name","picture","email","email_verified","org_id"],dT=["client_id","redirect_uri","response_type","code_challenge","code_challenge_method","state","nonce"],dU="openid profile email offline_access";function dV(a,b){return new URL(cR((a=>{var b;let c=process.env.NEXT_PUBLIC_BASE_PATH;return c?cQ((b=c)&&!b.startsWith("/")?`/${b}`:b)+cR(a):a})(a)),cQ(b))}class dW{constructor(a){if(this.fetch=a.fetch||fetch,this.jwksCache=a.jwksCache||{},this.allowInsecureRequests=a.allowInsecureRequests??!1,this.httpTimeout=a.httpTimeout??5e3,this.httpOptions=()=>{let b=new Headers;if(a.enableTelemetry??!0){let a="nextjs-auth0",c=cP.rE;b.set("User-Agent",`${a}/${c}`),b.set("Auth0-Client",dX(JSON.stringify({name:a,version:c})))}return{signal:AbortSignal.timeout(this.httpTimeout),headers:b}},this.allowInsecureRequests&&console.warn("allowInsecureRequests is enabled in a production environment. This is not recommended."),this.transactionStore=a.transactionStore,this.sessionStore=a.sessionStore,this.domain=a.domain,this.clientMetadata={client_id:a.clientId},this.clientSecret=a.clientSecret,this.authorizationParameters=a.authorizationParameters||{scope:dU},this.pushedAuthorizationRequests=a.pushedAuthorizationRequests??!1,this.clientAssertionSigningKey=a.clientAssertionSigningKey,this.clientAssertionSigningAlg=a.clientAssertionSigningAlg||"RS256",this.authorizationParameters.scope||(this.authorizationParameters.scope=dU),!this.authorizationParameters.scope.split(" ").map(a=>a.trim()).includes("openid"))throw Error("The 'openid' scope must be included in the set of scopes. See https://auth0.com/docs");this.appBaseUrl=a.appBaseUrl,this.signInReturnToPath=a.signInReturnToPath||"/";let b=["auto","oidc","v2"],c=a.logoutStrategy||"auto";b.includes(c)||(console.error(`Invalid logoutStrategy: ${c}. Must be one of: ${b.join(", ")}. Defaulting to "auto"`),c="auto"),this.logoutStrategy=c,this.includeIdTokenHintInOIDCLogoutUrl=a.includeIdTokenHintInOIDCLogoutUrl??!0,this.beforeSessionSaved=a.beforeSessionSaved,this.onCallback=a.onCallback||this.defaultOnCallback,this.routes=a.routes,this.enableAccessTokenEndpoint=a.enableAccessTokenEndpoint??!0,this.noContentProfileResponseWhenUnauthenticated=a.noContentProfileResponseWhenUnauthenticated??!1}async handler(a){let{pathname:b}=a.nextUrl,c=b.endsWith("/")?b.slice(0,-1):b,d=a.method;if("GET"===d&&c===this.routes.login)return this.handleLogin(a);{if("GET"===d&&c===this.routes.logout)return this.handleLogout(a);if("GET"===d&&c===this.routes.callback)return this.handleCallback(a);if("GET"===d&&c===this.routes.profile)return this.handleProfile(a);if("GET"===d&&c===this.routes.accessToken&&this.enableAccessTokenEndpoint)return this.handleAccessToken(a);if("POST"===d&&c===this.routes.backChannelLogout)return this.handleBackChannelLogout(a);let b=q.NextResponse.next(),e=await this.sessionStore.get(a.cookies);return e&&(await this.sessionStore.set(a.cookies,b.cookies,{...e}),dQ(b)),b}}async startInteractiveLogin(a={}){let b=dV(this.routes.callback,this.appBaseUrl),c=this.signInReturnToPath;if(a.returnTo){let b=new URL(this.authorizationParameters.redirect_uri||this.appBaseUrl),d=function(a,b){let c;try{c=new URL(a,b)}catch(a){return}if(c.origin===b.origin)return c}(a.returnTo,b);d&&(c=d.pathname+d.search+d.hash)}let d=bm(),e=await bn(d),f=bm(),g=bm(),h=new URLSearchParams;h.set("client_id",this.clientMetadata.client_id),h.set("redirect_uri",b.toString()),h.set("response_type","code"),h.set("code_challenge",e),h.set("code_challenge_method","S256"),h.set("state",f),h.set("nonce",g),Object.entries({...this.authorizationParameters,...a.authorizationParameters}).forEach(([a,b])=>{dT.includes(a)||null==b||h.set(a,String(b))});let i={nonce:g,maxAge:this.authorizationParameters.max_age,codeVerifier:d,responseType:"code",state:f,returnTo:c},[j,k]=await this.authorizationUrl(h);if(j)return new q.NextResponse("An error occured while trying to initiate the login request.",{status:500});let l=q.NextResponse.redirect(k.toString());return await this.transactionStore.save(l.cookies,i),l}async handleLogin(a){let{returnTo:b,...c}=Object.fromEntries(a.nextUrl.searchParams.entries());return this.startInteractiveLogin({authorizationParameters:c,returnTo:b})}async handleLogout(a){let b,c=await this.sessionStore.get(a.cookies),[d,e]=await this.discoverAuthorizationServerMetadata();if(d){let b=new q.NextResponse("An error occured while trying to initiate the logout request.",{status:500});return await this.sessionStore.delete(a.cookies,b.cookies),await this.transactionStore.deleteAll(a.cookies,b.cookies),b}let f=a.nextUrl.searchParams.get("returnTo")||this.appBaseUrl,g=a.nextUrl.searchParams.has("federated"),h=()=>{let a=new URL("/v2/logout",this.issuer);return a.searchParams.set("returnTo",f),a.searchParams.set("client_id",this.clientMetadata.client_id),g&&a.searchParams.set("federated",""),q.NextResponse.redirect(a)},i=()=>{let a=new URL(e.end_session_endpoint);return a.searchParams.set("client_id",this.clientMetadata.client_id),a.searchParams.set("post_logout_redirect_uri",f),c?.internal.sid&&a.searchParams.set("logout_hint",c.internal.sid),this.includeIdTokenHintInOIDCLogoutUrl&&c?.tokenSet.idToken&&a.searchParams.set("id_token_hint",c.tokenSet.idToken),g&&a.searchParams.set("federated",""),q.NextResponse.redirect(a)};if("v2"===this.logoutStrategy)b=h();else if("oidc"===this.logoutStrategy){if(!e.end_session_endpoint){let b=new q.NextResponse("OIDC RP-Initiated Logout is not supported by the authorization server. Enable it or use a different logout strategy.",{status:500});return await this.sessionStore.delete(a.cookies,b.cookies),await this.transactionStore.deleteAll(a.cookies,b.cookies),b}b=i()}else e.end_session_endpoint?b=i():(console.warn("The Auth0 client does not have RP-initiated logout enabled, the user will be redirected to the `/v2/logout` endpoint instead. Learn how to enable it here: https://auth0.com/docs/authenticate/login/logout/log-users-out-of-auth0#enable-endpoint-discovery"),b=h());return await this.sessionStore.delete(a.cookies,b.cookies),dQ(b),await this.transactionStore.deleteAll(a.cookies,b.cookies),b}async handleCallback(a){let b,c,d,e=a.nextUrl.searchParams.get("state");if(!e)return this.handleCallbackError(new u,{},a);let f=await this.transactionStore.get(a.cookies,e);if(!f)return this.onCallback(new v,{},null);let g=f.payload,h={returnTo:g.returnTo},[i,j]=await this.discoverAuthorizationServerMetadata();if(i)return this.handleCallbackError(i,h,a,e);try{b=function(a,b,c,d){var e;if(br(a),bs(b),c instanceof URL&&(c=c.searchParams),!(c instanceof URLSearchParams))throw a_('"parameters" must be an instance of URLSearchParams, or URL',a$);if(cp(c,"response"))throw bb('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',b9,{parameters:c});let f=cp(c,"iss"),g=cp(c,"state");if(!f&&a.authorization_response_iss_parameter_supported)throw bb('response parameter "iss" (issuer) missing',b9,{parameters:c});if(f&&f!==a.issuer)throw bb('unexpected "iss" (issuer) response parameter value',b9,{expected:a.issuer,parameters:c});switch(d){case void 0:case cr:if(void 0!==g)throw bb('unexpected "state" response parameter encountered',b9,{expected:void 0,parameters:c});break;case cq:break;default:if(bj(d,'"expectedState" argument'),g!==d)throw bb(void 0===g?'response parameter "state" missing':'unexpected "state" response parameter value',b9,{expected:d,parameters:c})}if(cp(c,"error"))throw new bB("authorization response from the server is an error",{cause:c});let h=cp(c,"id_token"),i=cp(c,"token");if(void 0!==h||void 0!==i)throw new a9("implicit and hybrid flows are not supported");return e=new URLSearchParams(c),bW.add(e),e}(j,this.clientMetadata,a.nextUrl.searchParams,g.state)}catch(b){return this.handleCallbackError(new w({cause:new s({code:b.error,message:b.error_description})}),h,a,e)}try{let a=dV(this.routes.callback,this.appBaseUrl);c=await bY(j,this.clientMetadata,await this.getClientAuth(),b,a.toString(),g.codeVerifier,{...this.httpOptions(),[a3]:this.fetch,[a0]:this.allowInsecureRequests})}catch(b){return this.handleCallbackError(new x(b.message),h,a,e)}try{d=await b1(j,this.clientMetadata,c,{expectedNonce:g.nonce,maxAge:g.maxAge,requireIdToken:!0})}catch(b){return this.handleCallbackError(new y({cause:new s({code:b.error,message:b.error_description})}),h,a,e)}let k=bR(d),l={user:k,tokenSet:{accessToken:d.access_token,idToken:d.id_token,scope:d.scope,refreshToken:d.refresh_token,expiresAt:Math.floor(Date.now()/1e3)+Number(d.expires_in)},internal:{sid:k.sid,createdAt:Math.floor(Date.now()/1e3)}},m=await this.onCallback(null,h,l);return l=await this.finalizeSession(l,d.id_token),await this.sessionStore.set(a.cookies,m.cookies,l,!0),dQ(m),await this.transactionStore.delete(m.cookies,e),m}async handleProfile(a){let b=await this.sessionStore.get(a.cookies);if(!b)return this.noContentProfileResponseWhenUnauthenticated?new q.NextResponse(null,{status:204}):new q.NextResponse(null,{status:401});let c=q.NextResponse.json(b?.user);return dQ(c),c}async handleAccessToken(a){let b=await this.sessionStore.get(a.cookies);if(!b)return q.NextResponse.json({error:{message:"The user does not have an active session.",code:m.MISSING_SESSION}},{status:401});let[c,d]=await this.getTokenSet(b.tokenSet);if(c)return q.NextResponse.json({error:{message:c.message,code:c.code}},{status:401});let{tokenSet:e,idTokenClaims:f}=d,g=q.NextResponse.json({token:e.accessToken,scope:e.scope,expires_at:e.expiresAt});if(e.accessToken!==b.tokenSet.accessToken||e.expiresAt!==b.tokenSet.expiresAt||e.refreshToken!==b.tokenSet.refreshToken){f&&(b.user=f);let c=await this.finalizeSession(b,e.idToken);await this.sessionStore.set(a.cookies,g.cookies,{...c,tokenSet:e}),dQ(g)}return g}async handleBackChannelLogout(a){if(!this.sessionStore.store)return new q.NextResponse("A session data store is not configured.",{status:500});if(!this.sessionStore.store.deleteByLogoutToken)return new q.NextResponse("Back-channel logout is not supported by the session data store.",{status:500});let b=new URLSearchParams(await a.text()).get("logout_token");if(!b)return new q.NextResponse("Missing `logout_token` in the request body.",{status:400});let[c,d]=await this.verifyLogoutToken(b);return c?new q.NextResponse(c.message,{status:400}):(await this.sessionStore.store.deleteByLogoutToken(d),new q.NextResponse(null,{status:204}))}async getTokenSet(a,b){if(!a.refreshToken&&a.expiresAt<=Date.now()/1e3)return[new C(m.MISSING_REFRESH_TOKEN,"The access token has expired and a refresh token was not provided. The user needs to re-authenticate."),null];if(a.refreshToken&&(b||a.expiresAt<=Date.now()/1e3)){let b,[c,d]=await this.discoverAuthorizationServerMetadata();if(c)return[c,null];let e=await bO(d,this.clientMetadata,await this.getClientAuth(),a.refreshToken,{...this.httpOptions(),[a3]:this.fetch,[a0]:this.allowInsecureRequests});try{b=await bT(d,this.clientMetadata,e)}catch(a){return[new C(m.FAILED_TO_REFRESH_TOKEN,"The access token has expired and there was an error while trying to refresh it.",new s({code:a.error,message:a.error_description})),null]}let f=bR(b),g=Math.floor(Date.now()/1e3)+Number(b.expires_in),h={...a,accessToken:b.access_token,idToken:b.id_token,expiresAt:g};return b.refresh_token?h.refreshToken=b.refresh_token:h.refreshToken=a.refreshToken,[null,{tokenSet:h,idTokenClaims:f}]}return[null,{tokenSet:a,idTokenClaims:void 0}]}async backchannelAuthentication(a){let[b,c]=await this.discoverAuthorizationServerMetadata();if(b)return[b,null];if(!c.backchannel_authentication_endpoint)return[new A,null];let d=new URLSearchParams;d.set("scope",dU),Object.entries({...this.authorizationParameters,...a.authorizationParams}).forEach(([a,b])=>d.set(a,String(b))),d.set("client_id",this.clientMetadata.client_id),d.set("binding_message",a.bindingMessage),d.set("login_hint",JSON.stringify({format:"iss_sub",iss:c.issuer,sub:a.loginHint.sub})),a.requestedExpiry&&d.append("requested_expiry",a.requestedExpiry.toString()),a.authorizationDetails&&d.append("authorization_details",JSON.stringify(a.authorizationDetails));let[e,f]=await this.getOpenIdClientConfig();if(e)return[e,null];try{let a=await cK(f,d),b=await cL(f,a),c=Math.floor(Date.now()/1e3)+Number(b.expires_in);return[null,{tokenSet:{accessToken:b.access_token,idToken:b.id_token,scope:b.scope,refreshToken:b.refresh_token,expiresAt:c},idTokenClaims:b.claims(),authorizationDetails:b.authorization_details}]}catch(a){return[new B({cause:new s({code:a.error,message:a.error_description})}),null]}}async discoverAuthorizationServerMetadata(){if(this.authorizationServerMetadata)return[null,this.authorizationServerMetadata];let a=new URL(this.issuer);try{let b=await bh(a,{...this.httpOptions(),[a3]:this.fetch,[a0]:this.allowInsecureRequests}).then(b=>bk(a,b));return this.authorizationServerMetadata=b,[null,b]}catch(b){return console.error(`An error occured while performing the discovery request. issuer=${a.toString()}, error:`,b),[new t("Discovery failed for the OpenID Connect configuration."),null]}}async defaultOnCallback(a,b){return a?new q.NextResponse(a.message,{status:500}):q.NextResponse.redirect(dV(b.returnTo||"/",this.appBaseUrl))}async handleCallbackError(a,b,c,d){let e=await this.onCallback(a,b,null);return d&&await this.transactionStore.delete(e.cookies,d),e}async verifyLogoutToken(a){let[b,c]=await this.discoverAuthorizationServerMetadata();if(b)return[b,null];let d=function(a,b){let c=new ap(a,b),d=async(a,b)=>c.getKey(a,b);return Object.defineProperties(d,{coolingDown:{get:()=>c.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>c.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>c.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>c.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>c.jwks(),enumerable:!0,configurable:!1,writable:!1}}),d}(new URL(c.jwks_uri),{[ao]:this.jwksCache}),{payload:e}=await aX(a,d,{issuer:c.issuer,audience:this.clientMetadata.client_id,algorithms:["RS256"],requiredClaims:["iat"]});return"sid"in e||"sub"in e?"sid"in e&&"string"!=typeof e.sid?[new z('"sid" claim must be a string'),null]:"sub"in e&&"string"!=typeof e.sub?[new z('"sub" claim must be a string'),null]:"nonce"in e?[new z('"nonce" claim is prohibited'),null]:"events"in e?"object"!=typeof e.events||null===e.events?[new z('"events" claim must be an object'),null]:"http://schemas.openid.net/event/backchannel-logout"in e.events?"object"!=typeof e.events["http://schemas.openid.net/event/backchannel-logout"]?[new z('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object'),null]:[null,{sid:e.sid,sub:e.sub}]:[new z('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim'),null]:[new z('"events" claim is missing'),null]:[new z('either "sid" or "sub" (or both) claims must be present'),null]}async authorizationUrl(a){let[b,c]=await this.discoverAuthorizationServerMetadata();if(b)return[b,null];if(this.pushedAuthorizationRequests&&!c.pushed_authorization_request_endpoint)return console.error("The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par"),[Error("The authorization server does not support pushed authorization requests."),null];let d=new URL(c.authorization_endpoint);if(this.pushedAuthorizationRequests){let b,e=await bz(c,this.clientMetadata,await this.getClientAuth(),a,{...this.httpOptions(),[a3]:this.fetch,[a0]:this.allowInsecureRequests});try{b=await bI(c,this.clientMetadata,e)}catch(a){return[new w({cause:new s({code:a.error,message:a.error_description}),message:"An error occured while pushing the authorization request."}),null]}return d.searchParams.set("request_uri",b.request_uri),d.searchParams.set("client_id",this.clientMetadata.client_id),[null,d]}return d.search=a.toString(),[null,d]}async getClientAuth(){if(!this.clientSecret&&!this.clientAssertionSigningKey)throw Error("The client secret or client assertion signing key must be provided.");let a=this.clientAssertionSigningKey;return a&&"string"==typeof a&&(a=await ag(a,this.clientAssertionSigningAlg)),a?function(a,b){let{key:c,kid:d}=a instanceof CryptoKey?{key:a}:a?.key instanceof CryptoKey?(void 0!==a.kid&&bj(a.kid,'"kid"'),{key:a.key,kid:a.kid}):{};var e='"clientPrivateKey.key"';if(!(c instanceof CryptoKey))throw a_(`${e} must be a CryptoKey`,a$);if("private"!==c.type)throw a_(`${e} must be a private CryptoKey`,aZ);return async(a,b,e,f)=>{let g={alg:function(a){switch(a.algorithm.name){case"RSA-PSS":switch(a.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new a9("unsupported RsaHashedKeyAlgorithm hash name",{cause:a})}case"RSASSA-PKCS1-v1_5":switch(a.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new a9("unsupported RsaHashedKeyAlgorithm hash name",{cause:a})}case"ECDSA":switch(a.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new a9("unsupported EcKeyAlgorithm namedCurve",{cause:a})}case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return a.algorithm.name;case"EdDSA":return"Ed25519";default:throw new a9("unsupported CryptoKey algorithm name",{cause:a})}}(c),kid:d},h=function(a,b){let c=bq()+bo(b);return{jti:bm(),aud:a.issuer,exp:c+60,iat:c,nbf:c,iss:b.client_id,sub:b.client_id}}(a,b);e.set("client_id",b.client_id),e.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),e.set("client_assertion",await bu(g,h,c))}}(a):bt(this.clientSecret)}get issuer(){return this.domain.startsWith("http://")||this.domain.startsWith("https://")?this.domain:`https://${this.domain}`}async getConnectionTokenSet(a,b,c){if(!a.refreshToken&&(!b||b.expiresAt<=Date.now()/1e3))return[new D(n.MISSING_REFRESH_TOKEN,"A refresh token was not present, Connection Access Token requires a refresh token. The user needs to re-authenticate."),null];if(a.refreshToken&&(!b||b.expiresAt<=Date.now()/1e3)){let b,d=new URLSearchParams;d.append("connection",c.connection);let e=c.subject_token_type??o.SUBJECT_TYPE_REFRESH_TOKEN,f=e===o.SUBJECT_TYPE_ACCESS_TOKEN?a.accessToken:a.refreshToken;d.append("subject_token_type",e),d.append("subject_token",f),d.append("requested_token_type","http://auth0.com/oauth/token-type/federated-connection-access-token"),c.login_hint&&d.append("login_hint",c.login_hint);let[g,h]=await this.discoverAuthorizationServerMetadata();if(g)return[g,null];let i=await cj(h,this.clientMetadata,await this.getClientAuth(),"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",d,{[a3]:this.fetch,[a0]:this.allowInsecureRequests});try{b=await ck(h,this.clientMetadata,i)}catch(a){return[new D(n.FAILED_TO_EXCHANGE,"There was an error trying to exchange the refresh token for a connection access token.",new s({code:a.error,message:a.error_description})),null]}return[null,{accessToken:b.access_token,expiresAt:Math.floor(Date.now()/1e3)+Number(b.expires_in),scope:b.scope,connection:c.connection}]}return[null,b]}async finalizeSession(a,b){if(this.beforeSessionSaved)a={...await this.beforeSessionSaved(a,b??null),internal:a.internal};else{var c;a.user=Object.keys(c=a.user).reduce((a,b)=>(dS.includes(b)&&(a[b]=c[b]),a),{})}return a}async getOpenIdClientConfig(){let[a,b]=await this.discoverAuthorizationServerMetadata();if(a)return[a,null];let c=new cH(b,this.clientMetadata.client_id,{},await this.getClientAuth()),d=new Headers(this.httpOptions().headers);return c[a3]=(...a)=>{let b=new Headers(a[1].headers);return this.fetch(a[0],{...a[1],headers:new Headers([...d,...b])})},c.timeout=this.httpTimeout,this.allowInsecureRequests&&(cz(c).tlsOnly=!1),[null,c]}}let dX=a=>{let b=new TextEncoder().encode(a),c=[];for(let a=0;a<b.length;a+=32768)c.push(String.fromCharCode.apply(null,b.subarray(a,a+32768)));return btoa(c.join(""))};class dY{constructor({secret:a,rolling:b=!0,absoluteDuration:c=259200,inactivityDuration:d=86400,store:e,cookieOptions:f}){this.secret=a,this.rolling=b,this.absoluteDuration=c,this.inactivityDuration=d,this.store=e,this.sessionCookieName=f?.name??"__session",this.cookieConfig={httpOnly:!0,sameSite:f?.sameSite??"lax",secure:f?.secure??!1,path:f?.path??"/",domain:f?.domain,transient:f?.transient}}epoch(){return Date.now()/1e3|0}calculateMaxAge(a){if(!this.rolling)return this.absoluteDuration;let b=Math.min(this.epoch()+this.inactivityDuration,a+this.absoluteDuration)-this.epoch();return b>0?b:0}}let dZ="appSession";function d$(a,b){let c=b.user;return{user:c,tokenSet:{idToken:b.idToken??void 0,accessToken:b.accessToken??void 0,scope:b.accessTokenScope,refreshToken:b.refreshToken,expiresAt:b.accessTokenExpiresAt},internal:{sid:c.sid,createdAt:a.iat}}}let d_=()=>{let a=new Uint8Array(16);return crypto.getRandomValues(a),Array.from(a).map(a=>a.toString(16).padStart(2,"0")).join("")};class d0 extends dY{constructor({secret:a,store:b,rolling:c,absoluteDuration:d,inactivityDuration:e,cookieOptions:f}){super({secret:a,rolling:c,absoluteDuration:d,inactivityDuration:e,cookieOptions:f}),this.store=b}async get(a){let b=a.get(this.sessionCookieName)||a.get(dZ);if(!b||!b.value)return null;let c=null;try{let a=await dI(b.value,this.secret);if(null===a)return null;c=a.payload.id}catch(a){if("ERR_JWE_INVALID"===a.code){let a=await dJ(b.name,b.value,this.secret);if(!a)return null;c=a}}if(!c)return null;let d=await this.store.get(c);return d?d.header?.iat?d$(d.header,d.data):d:null}async set(a,b,c,d=!1){let e=null,f=a.get(this.sessionCookieName)?.value;if(f){let a=await dI(f,this.secret);a&&(e=a.payload.id)}e&&d&&(await this.store.delete(e),e=d_()),e||(e=d_());let g=this.calculateMaxAge(c.internal.createdAt),h=Date.now()/1e3+g,i=await dH({id:e},this.secret,h);b.set(this.sessionCookieName,i.toString(),{...this.cookieConfig,maxAge:g}),await this.store.set(e,c),a.set(this.sessionCookieName,i.toString()),this.sessionCookieName!==dZ&&a.has(dZ)&&dR(b,dZ,{domain:this.cookieConfig.domain,path:this.cookieConfig.path})}async delete(a,b){let c=a.get(this.sessionCookieName)?.value;if(dR(b,this.sessionCookieName,{domain:this.cookieConfig.domain,path:this.cookieConfig.path}),!c)return;let d=await dI(c,this.secret);d&&await this.store.delete(d.payload.id)}}class d1 extends dY{constructor({secret:a,rolling:b,absoluteDuration:c,inactivityDuration:d,cookieOptions:e}){super({secret:a,rolling:b,absoluteDuration:c,inactivityDuration:d,cookieOptions:e}),this.connectionTokenSetsCookieName="__FC"}async get(a){let b=dO(this.sessionCookieName,a)??dO(dZ,a,!0);if(!b)return null;let c=await dI(b,this.secret);if(!c)return null;let d=c.protectedHeader.iat?d$(c.protectedHeader,c.payload):c.payload,e=this.getConnectionTokenSetsCookies(a),f=[];for(let a of e){let b=await dI(a.value,this.secret);b&&f.push(b.payload)}return{...d,...f.length?{connectionTokenSets:f}:{}}}async set(a,b,c){let{connectionTokenSets:d,...e}=c,f=this.calculateMaxAge(c.internal.createdAt),g=Math.floor(Date.now()/1e3)+f,h=(await dH(e,this.secret,g)).toString(),i={...this.cookieConfig,maxAge:f};!function(a,b,c,d,e){let{transient:f,...g}=c,h={...g};if(f&&delete h.maxAge,new TextEncoder().encode(b).length<=3500){e.set(a,b,h),d.set(a,b),dN(d,a).forEach(a=>{dR(e,a.name,{path:h.path,domain:h.domain}),d.delete(a.name)});return}let i=0,j=0;for(;i<b.length;){let c=b.slice(i,i+3500),f=`${a}__${j}`;e.set(f,c,h),d.set(f,c),i+=3500,j++}let k=dN(d,a).length-j;if(k>0)for(let b=0;b<k;b++){let c=j+b,f=`${a}__${c}`;dR(e,f,{path:h.path,domain:h.domain}),d.delete(f)}dR(e,a,{path:h.path,domain:h.domain}),d.delete(a)}(this.sessionCookieName,h,i,a,b),d?.length&&await Promise.all(d.map((c,d)=>this.storeInCookie(a,b,c,`${this.connectionTokenSetsCookieName}_${d}`,f))),dP(dZ,a,b,!0,{domain:this.cookieConfig.domain,path:this.cookieConfig.path})}async delete(a,b){let c={domain:this.cookieConfig.domain,path:this.cookieConfig.path};dP(this.sessionCookieName,a,b,!1,c),this.getConnectionTokenSetsCookies(a).forEach(a=>dR(b,a.name,c))}async storeInCookie(a,b,c,d,e){let f=Math.floor(Date.now()/1e3+e),g=await dH(c,this.secret,f),h=g.toString();b.set(d,g.toString(),{...this.cookieConfig,maxAge:e}),a.set(d,h);let i=new cX(new Headers);i.set(d,h,{...this.cookieConfig,maxAge:e}),new TextEncoder().encode(i.toString()).length>=4096&&(d===this.sessionCookieName?console.warn(`The ${d} cookie size exceeds 4096 bytes, which may cause issues in some browsers. Consider removing any unnecessary custom claims from the access token or the user profile. Alternatively, you can use a stateful session implementation to store the session data in a data store.`):console.warn(`The ${d} cookie size exceeds 4096 bytes, which may cause issues in some browsers. You can use a stateful session implementation to store the session data in a data store.`))}getConnectionTokenSetsCookies(a){return a.getAll().filter(a=>a.name.startsWith(this.connectionTokenSetsCookieName))}}class d2{constructor({secret:a,cookieOptions:b,enableParallelTransactions:c}){this.secret=a,this.transactionCookiePrefix=b?.prefix??"__txn_",this.cookieOptions={httpOnly:!0,sameSite:b?.sameSite??"lax",secure:b?.secure??!1,path:b?.path??"/",domain:b?.domain,maxAge:b?.maxAge||3600},this.enableParallelTransactions=c??!0}getTransactionCookieName(a){return this.enableParallelTransactions?`${this.transactionCookiePrefix}${a}`:`${this.transactionCookiePrefix}`}getCookiePrefix(){return this.transactionCookiePrefix}async save(a,b,c){if(!b.state)throw Error("Transaction state is required");if(c&&!this.enableParallelTransactions){let a=this.getTransactionCookieName(b.state);if(c.get(a))return void console.warn("A transaction is already in progress. Only one transaction is allowed when parallel transactions are disabled.")}let d=this.cookieOptions.maxAge,e=Math.floor(Date.now()/1e3+d),f=await dH(b,this.secret,e);a.set(this.getTransactionCookieName(b.state),f.toString(),this.cookieOptions)}async get(a,b){let c=this.getTransactionCookieName(b),d=a.get(c)?.value;return d?dI(d,this.secret):null}async delete(a,b){dR(a,this.getTransactionCookieName(b),{domain:this.cookieOptions.domain,path:this.cookieOptions.path})}async deleteAll(a,b){let c=this.getCookiePrefix(),d={domain:this.cookieOptions.domain,path:this.cookieOptions.path};a.getAll().forEach(a=>{a.name.startsWith(c)&&dR(b,a.name,d)})}}class d3{constructor(a={}){let{domain:b,clientId:c,clientSecret:d,appBaseUrl:e,secret:f,clientAssertionSigningKey:g}=this.validateAndExtractRequiredOptions(a),h=a.clientAssertionSigningAlg||process.env.AUTH0_CLIENT_ASSERTION_SIGNING_ALG,i=process.env.NEXT_PUBLIC_BASE_PATH,j={name:a.session?.cookie?.name??"__session",secure:a.session?.cookie?.secure??"true"===process.env.AUTH0_COOKIE_SECURE,sameSite:a.session?.cookie?.sameSite??process.env.AUTH0_COOKIE_SAME_SITE??"lax",path:a.session?.cookie?.path??process.env.AUTH0_COOKIE_PATH??i??"/",transient:a.session?.cookie?.transient??"true"===process.env.AUTH0_COOKIE_TRANSIENT,domain:a.session?.cookie?.domain??process.env.AUTH0_COOKIE_DOMAIN},k={prefix:a.transactionCookie?.prefix??"__txn_",secure:a.transactionCookie?.secure??!1,sameSite:a.transactionCookie?.sameSite??"lax",path:a.transactionCookie?.path??i??"/",maxAge:a.transactionCookie?.maxAge??3600};if(e){let{protocol:a}=new URL(e);"https:"===a&&(j.secure=!0,k.secure=!0)}this.routes={login:process.env.NEXT_PUBLIC_LOGIN_ROUTE||"/auth/login",logout:"/auth/logout",callback:"/auth/callback",backChannelLogout:"/auth/backchannel-logout",profile:process.env.NEXT_PUBLIC_PROFILE_ROUTE||"/auth/profile",accessToken:process.env.NEXT_PUBLIC_ACCESS_TOKEN_ROUTE||"/auth/access-token",...a.routes},this.transactionStore=new d2({secret:f,cookieOptions:k,enableParallelTransactions:a.enableParallelTransactions??!0}),this.sessionStore=a.sessionStore?new d0({...a.session,secret:f,store:a.sessionStore,cookieOptions:j}):new d1({...a.session,secret:f,cookieOptions:j}),this.authClient=new dW({transactionStore:this.transactionStore,sessionStore:this.sessionStore,domain:b,clientId:c,clientSecret:d,clientAssertionSigningKey:g,clientAssertionSigningAlg:h,authorizationParameters:a.authorizationParameters,pushedAuthorizationRequests:a.pushedAuthorizationRequests,appBaseUrl:e,secret:f,signInReturnToPath:a.signInReturnToPath,logoutStrategy:a.logoutStrategy,includeIdTokenHintInOIDCLogoutUrl:a.includeIdTokenHintInOIDCLogoutUrl,beforeSessionSaved:a.beforeSessionSaved,onCallback:a.onCallback,routes:this.routes,allowInsecureRequests:a.allowInsecureRequests,httpTimeout:a.httpTimeout,enableTelemetry:a.enableTelemetry,enableAccessTokenEndpoint:a.enableAccessTokenEndpoint,noContentProfileResponseWhenUnauthenticated:a.noContentProfileResponseWhenUnauthenticated})}middleware(a){return this.authClient.handler.bind(this.authClient)(a)}async getSession(a){return a?a instanceof q.NextRequest?this.sessionStore.get(a.cookies):this.sessionStore.get(this.createRequestCookies(a)):this.sessionStore.get(await (0,p.U)())}async getAccessToken(a,b,c){let d,e,f={refresh:!1},g={};if(a&&(a instanceof Request||"object"==typeof a.headers)){if(d=a,e=b,g={...f,...c??{}},!e)throw TypeError("getAccessToken(req, res): The 'res' argument is missing. Both 'req' and 'res' must be provided together for Pages Router or middleware usage.")}else{if(void 0!==b||void 0!==c)throw TypeError("getAccessToken: Invalid arguments. Valid signatures are getAccessToken(), getAccessToken(options), or getAccessToken(req, res, options).");g={...f,...a??{}}}let h=d?await this.getSession(d):await this.getSession();if(!h)throw new C(m.MISSING_SESSION,"The user does not have an active session.");let[i,j]=await this.authClient.getTokenSet(h.tokenSet,g.refresh);if(i)throw i;let{tokenSet:k,idTokenClaims:l}=j;if(k.accessToken!==h.tokenSet.accessToken||k.expiresAt!==h.tokenSet.expiresAt||k.refreshToken!==h.tokenSet.refreshToken){l&&(h.user=l);let a=await this.authClient.finalizeSession(h,k.idToken);await this.saveToSession({...a,tokenSet:k},d,e)}return{token:k.accessToken,scope:k.scope,expiresAt:k.expiresAt}}async getAccessTokenForConnection(a,b,c){let d=b?await this.getSession(b):await this.getSession();if(!d)throw new D(n.MISSING_SESSION,"The user does not have an active session.");let e=d.connectionTokenSets?.find(b=>b.connection===a.connection),[f,g]=await this.authClient.getConnectionTokenSet(d.tokenSet,e,a);if(null!==f)throw f;if(g&&(!e||g.accessToken!==e.accessToken||g.expiresAt!==e.expiresAt||g.scope!==e.scope)){let f;f=e?d.connectionTokenSets?.map(b=>b.connection===a.connection?g:b):[...d.connectionTokenSets||[],g],await this.saveToSession({...d,connectionTokenSets:f},b,c)}return{token:g.accessToken,scope:g.scope,expiresAt:g.expiresAt}}async updateSession(a,b,c){if(b){if(!c)throw Error("The session data is missing.");if(a instanceof q.NextRequest&&b instanceof q.NextResponse){let d=await this.getSession(a);if(!d)throw Error("The user is not authenticated.");await this.sessionStore.set(a.cookies,b.cookies,{...c,internal:{...d.internal}})}else{let d=await this.getSession(a);if(!d)throw Error("The user is not authenticated.");let e=new Headers,f=new cX(e),g=this.createRequestCookies(a);for(let[a,h]of(await this.sessionStore.set(g,f,{...c,internal:{...d.internal}}),e.entries()))b.setHeader(a,h)}}else{let b=await this.getSession();if(!b)throw Error("The user is not authenticated.");if(!a)throw Error("The session data is missing.");await this.sessionStore.set(await (0,p.U)(),await (0,p.U)(),{...a,internal:{...b.internal}})}}createRequestCookies(a){let b=new Headers;for(let c in a.headers)if(Array.isArray(a.headers[c]))for(let d of a.headers[c])b.append(c,d);else b.append(c,a.headers[c]??"");return new cW(b)}async startInteractiveLogin(a={}){return this.authClient.startInteractiveLogin(a)}async getTokenByBackchannelAuth(a){let[b,c]=await this.authClient.backchannelAuthentication(a);if(b)throw b;return c}withPageAuthRequired(a,b){let d,e,f={loginUrl:this.routes.login},g=(d=this,(a,b={})=>async e=>{let g=await d.getSession();if(!g?.user){let a="function"==typeof b.returnTo?await b.returnTo(e):b.returnTo,{redirect:d}=await c.e(161).then(c.bind(c,2161));d(`${f.loginUrl}${b.returnTo?`?returnTo=${a}`:""}`)}return a(e)}),h=(e=this,({getServerSideProps:a,returnTo:b}={})=>async c=>{let d=await e.getSession(c.req);if(!d?.user)return{redirect:{destination:`${f.loginUrl}?returnTo=${encodeURIComponent(b||c.resolvedUrl)}`,permanent:!1}};let g={props:{}};if(a&&(g=await a(c)),g.props instanceof Promise){let a=await g.props;return{...g,props:{user:d.user,...a}}}return{...g,props:{user:d.user,...g.props}}});return"function"==typeof a?g(a,b):h(a)}withApiAuthRequired(a){let b,c,d=(b=this,a=>async(c,d)=>{let e=await b.getSession(c);if(!e||!e.user)return void d.status(401).json({error:"not_authenticated",description:"The user does not have an active session or is not authenticated"});await a(c,d)}),e=(c=this,a=>async(b,d)=>{let e=await c.getSession();if(!e||!e.user)return q.NextResponse.json({error:"not_authenticated",description:"The user does not have an active session or is not authenticated"},{status:401});let f=await a(b,d);return f instanceof q.NextResponse?f:new q.NextResponse(f.body,f)});return(b,c)=>b instanceof Request||b.headers instanceof Headers||"boolean"==typeof b.bodyUsed?e(a)(b,c):d(a)(b,c)}async saveToSession(a,b,c){if(b&&c)if(b instanceof q.NextRequest&&c instanceof q.NextResponse)await this.sessionStore.set(b.cookies,c.cookies,a);else{let d=new Headers,e=new cX(d);for(let[f,g]of(await this.sessionStore.set(this.createRequestCookies(b),e,a),d.entries()))c.setHeader(f,g)}else try{await this.sessionStore.set(await (0,p.U)(),await (0,p.U)(),a)}catch(a){}}validateAndExtractRequiredOptions(a){let b={domain:a.domain??process.env.AUTH0_DOMAIN,clientId:a.clientId??process.env.AUTH0_CLIENT_ID,appBaseUrl:a.appBaseUrl??process.env.APP_BASE_URL,secret:a.secret??process.env.AUTH0_SECRET},c=a.clientSecret??process.env.AUTH0_CLIENT_SECRET,d=a.clientAssertionSigningKey??process.env.AUTH0_CLIENT_ASSERTION_SIGNING_KEY,e=Object.entries(b).filter(([,a])=>!a).map(([a])=>a);if(c||d||e.push("clientAuthentication"),e.length){let a={domain:"AUTH0_DOMAIN",clientId:"AUTH0_CLIENT_ID",appBaseUrl:"APP_BASE_URL",secret:"AUTH0_SECRET"},b="WARNING: Not all required options were provided when creating an instance of Auth0Client. Ensure to provide all missing options, either by passing it to the Auth0Client constructor, or by setting the corresponding environment variable.\n";e.forEach(c=>{"clientAuthentication"===c?b+=`Missing: clientAuthentication: Set either AUTH0_CLIENT_SECRET env var or AUTH0_CLIENT_ASSERTION_SIGNING_KEY env var, or pass clientSecret or clientAssertionSigningKey in options
`:a[c]?b+=`Missing: ${c}: Set ${a[c]} env var or pass ${c} in options
`:b+=`Missing: ${c}
`}),console.error(b.trim())}return{...b,clientSecret:c,clientAssertionSigningKey:d}}}},4230:(a,b,c)=>{Object.defineProperty(b,"U",{enumerable:!0,get:function(){return n}});let d=c(8706),e=c(3675),f=c(9294),g=c(3033),h=c(6906),i=c(1938),j=c(2831),k=c(787),l=c(1716),m=c(9290);function n(){let a="cookies",b=f.workAsyncStorage.getStore(),c=g.workUnitAsyncStorage.getStore();if(b){if(c&&"after"===c.phase&&!(0,l.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${b.route} used "cookies" inside "after(...)". This is not supported. If you need this data inside an "after" callback, use "cookies" outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E88",enumerable:!1,configurable:!0});if(b.forceStatic)return p(d.RequestCookiesAdapter.seal(new e.RequestCookies(new Headers({}))));if(b.dynamicShouldError)throw Object.defineProperty(new i.StaticGenBailoutError(`Route ${b.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`cookies\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E549",enumerable:!1,configurable:!0});if(c)switch(c.type){case"cache":let f=Object.defineProperty(Error(`Route ${b.route} used "cookies" inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "cookies" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E398",enumerable:!1,configurable:!0});throw Error.captureStackTrace(f,n),b.invalidDynamicUsageError??=f,f;case"unstable-cache":throw Object.defineProperty(Error(`Route ${b.route} used "cookies" inside a function cached with "unstable_cache(...)". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "cookies" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E157",enumerable:!1,configurable:!0});case"prerender":var k=b,q=c;let g=o.get(q);if(g)return g;let r=(0,j.makeHangingPromise)(q.renderSignal,k.route,"`cookies()`");return o.set(q,r),r;case"prerender-client":let s="`cookies`";throw Object.defineProperty(new m.InvariantError(`${s} must not be used within a client component. Next.js should be preventing ${s} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,h.postponeWithTracking)(b.route,a,c.dynamicTracking);case"prerender-legacy":return(0,h.throwToInterruptStaticGeneration)(a,b,c);case"prerender-runtime":return(0,h.delayUntilRuntimeStage)(c,function(a){let b=o.get(a);if(b)return b;let c=Promise.resolve(a);return o.set(a,c),c}(c.cookies));case"private-cache":return p(c.cookies);case"request":return(0,h.trackDynamicDataInDynamicRender)(c),p((0,d.areCookiesMutableInCurrentPhase)(c)?c.userspaceMutableCookies:c.cookies)}}(0,g.throwForMissingRequestStore)(a)}c(3036);let o=new WeakMap;function p(a){let b=o.get(a);if(b)return b;let c=Promise.resolve(a);return o.set(a,c),Object.defineProperties(c,{[Symbol.iterator]:{value:a[Symbol.iterator]?a[Symbol.iterator].bind(a):q.bind(a)},size:{get:()=>a.size},get:{value:a.get.bind(a)},getAll:{value:a.getAll.bind(a)},has:{value:a.has.bind(a)},set:{value:a.set.bind(a)},delete:{value:a.delete.bind(a)},clear:{value:"function"==typeof a.clear?a.clear.bind(a):r.bind(a,c)},toString:{value:a.toString.bind(a)}}),c}function q(){return this.getAll().map(a=>[a.name,a]).values()}function r(a){for(let a of this.getAll())this.delete(a.name);return a}(0,k.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`cookies()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E223",enumerable:!1,configurable:!0})})},4603:(a,b,c)=>{let d=c(7675),e=c(9294),f=c(3033),g=c(6906),h=c(1938),i=c(2831),j=c(787),k=c(1716),l=c(9290);c(3036);new WeakMap;(0,j.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`headers()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E277",enumerable:!1,configurable:!0})})},8706:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{MutableRequestCookiesAdapter:function(){return l},ReadonlyRequestCookiesError:function(){return g},RequestCookiesAdapter:function(){return h},appendMutableCookies:function(){return k},areCookiesMutableInCurrentPhase:function(){return n},createCookiesWithMutableAccessCheck:function(){return m},getModifiedCookieValues:function(){return j},responseCookiesToRequestCookies:function(){return p}});let d=c(3675),e=c(3036),f=c(9294);class g extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new g}}class h{static seal(a){return new Proxy(a,{get(a,b,c){switch(b){case"clear":case"delete":case"set":return g.callable;default:return e.ReflectAdapter.get(a,b,c)}}})}}let i=Symbol.for("next.mutated.cookies");function j(a){let b=a[i];return b&&Array.isArray(b)&&0!==b.length?b:[]}function k(a,b){let c=j(b);if(0===c.length)return!1;let e=new d.ResponseCookies(a),f=e.getAll();for(let a of c)e.set(a);for(let a of f)e.set(a);return!0}class l{static wrap(a,b){let c=new d.ResponseCookies(new Headers);for(let b of a.getAll())c.set(b);let g=[],h=new Set,j=()=>{let a=f.workAsyncStorage.getStore();if(a&&(a.pathWasRevalidated=!0),g=c.getAll().filter(a=>h.has(a.name)),b){let a=[];for(let b of g){let c=new d.ResponseCookies(new Headers);c.set(b),a.push(c.toString())}b(a)}},k=new Proxy(c,{get(a,b,c){switch(b){case i:return g;case"delete":return function(...b){h.add("string"==typeof b[0]?b[0]:b[0].name);try{return a.delete(...b),k}finally{j()}};case"set":return function(...b){h.add("string"==typeof b[0]?b[0]:b[0].name);try{return a.set(...b),k}finally{j()}};default:return e.ReflectAdapter.get(a,b,c)}}});return k}}function m(a){let b=new Proxy(a.mutableCookies,{get(c,d,f){switch(d){case"delete":return function(...d){return o(a,"cookies().delete"),c.delete(...d),b};case"set":return function(...d){return o(a,"cookies().set"),c.set(...d),b};default:return e.ReflectAdapter.get(c,d,f)}}});return b}function n(a){return"action"===a.phase}function o(a,b){if(!n(a))throw new g}function p(a){let b=new d.RequestCookies(new Headers);for(let c of a.getAll())b.set(c);return b}}};